{
    "contents" : "#SCRIPT FOR KONVERTERING TIL FLATFIL\n#Todo: \n#test av tidy-pakke på indikatordata\nlibrary(tidyr)\n\ntest <- read.csv(\"training_files/04-befolkning_alder-bydel-2014.csv\", header=FALSE, row.names=NULL, sep=\";\", na.strings = c(\"NA\",\".\",\":\"),stringsAsFactors = F)\n\n#tilnærming: multiple variables stored in one column\n#steg 1: samle verdier til en kolonnetittel\ndataHead = data.frame(test[1:4,])\ndataHead = data.frame(t(dataHead))\nnavn = colnames(dataHead)\ndataHead$kode <- do.call(paste, c(dataHead[navn], sep=\"-\"))\ndataHead = data.frame(t(dataHead))\n\n#STEG 2:setter inn en ny rad på et spesifisert sted og fjerner øverste rader\nover_kutt=4\ntestDF <- rbind(test[1:over_kutt,],dataHead[5,],test[-(1:over_kutt),])\ncolnames(testDF)=testDF[5,]\ntestDF=testDF[6:24,]\n\n#rydder slik at første kolonne inneholder riktige rownames og fjerner overflødige kolonner\n#bydel må være en variabel på linje med de andre, må legges inn over-.\ntestDF=testDF[,2:66]\ntestDF=subset(testDF,select=-`Bydel\\nnavn---`)\n\n#STEG 3: Split\n#samler alt opp først\ntemp_a=names(testDF[1])\nsamlaDF=gather(data=testDF,variabler,verdier,-`bydel_nr---`)\n\n#splitter så opp. må gjøres posisjonsvis.\nsplitDF=separate(samlaDF,variabler,c(\"innvkat\",\"alder_grupper\",\"kjonn\",\"enhet\"),\"-\")\n\n#splitter verdiene\nsplitDF=separate(splitDF,innvkat,c(\"variabel\",\"innvkat_3\"),\"\\\\.\")\nsplitDF=separate(splitDF,alder_grupper,c(\"variabel\",\"alder_grupper\"),\"\\\\.\")\nsplitDF=separate(splitDF,kjonn,c(\"variabel\",\"kjonn\"),\"\\\\.\")\nsplitDF=separate(splitDF,enhet,c(\"variabel\",\"enhet\"),\"\\\\.\")\n\nsplitDF[,1]\n#ferdig DF\nferdigDF=data.frame(splitDF[,1],splitDF$innvkat_3,splitDF$alder_grupper,splitDF$kjonn,splitDF$enhet,splitDF$verdier)\ncolnames(ferdigDF)=c(\"bydel_nr\",\"innvkat_3\",\"alder_grupper_5\",\"kjonn\",\"enhet\",\"tabellvariabel\")\n\n#test mot benglers konverterte flatfil\nlibrary(dplyr)\nkontroll_1 <- read.csv(\"data/befolkning_alder.csv\", header=T, row.names=NULL, sep=\",\", na.strings = \"NA\",stringsAsFactors = F)\nkontroll_2=subset(kontroll_1,subset=bydel_nr!=\"NULL\",select=c(-fylke_nr,-kommune_nr,-naringsregion_nr,-tabell_navn,-aar))\nkontroll_3=anti_join(kontroll_2,ferdigDF)\n",
    "created" : 1444246098153.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "291069005",
    "id" : "DAB86240",
    "lastKnownWriteTime" : 1444248909,
    "path" : "D:/R/imdikator-munch/flatfilkonvertering.R",
    "project_path" : "flatfilkonvertering.R",
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "type" : "r_source"
}