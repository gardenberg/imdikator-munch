{
    "contents" : "#SCRIPT FOR DIAGNOSE\n\n#RYDDEAMBISJON\n#dette scriptet må dokumentere hva som er kommet inn, og hva som er gjort med disse filene.\n#først: hvilke endringer og rettelser som er gjort på Benglers flatfilleveranse\n#så: hva som er gjort med SSBs leveranse i 2015\n\n#BEFOLKNING-ALDER\nbefolkning_alder <- read.csv2(\"D:/R/imdikator-munch/data_flat_input/befolkning_alder_B.csv\", stringsAsFactors=FALSE,colClasses = \"character\")\n#etter visuell inspeksjon\n#1: en kolonne for mye\n#2: alder_grupper-variabler har - som skilletegn, ikke _\n#3: X_id, ikke X_nr\n#4: bydel_nr mangler 0301 først.\n#5: enhet-variabel er person, ikke personer\n#6: alder_grupper-dimensjon mangler alle-variabel\n#7: må ha sep=, dec=.\n#8: fylke=00 og alle andre fylker kan ikke legges i ulike filer. disse må splices.\n#løses i variabel_adding.R\n\n#BARNEHAGEDELTAKELSE\ntest <- read.csv(\"D:/R/imdikator-munch/data_flat_output/barnehagedeltakelse_spraak-bydel-2013.csv\", stringsAsFactors=FALSE,colClasses = \"character\")\nwrite.csv(test,\"data_flat_output/test.csv\",row.names = F)\n\n#19.01.2016\n#nytt problem oppdaga - trodde først ettåringer er for høye\n#men det ser ut til å være feilkoding - ettåringer/barn ellers -> alle/barn ellers\n#ettåringer må fortsatt beregnes, men etter omkoding\n#alle prosenter for barn ellers alle grupper bhgalder må regnes på nytt\nbarn <- read.csv(\"D:/R/imdikator-munch/data_flat_input/barnehagedeltakelse_barnikommune-kommune-2014.csv\", row.names=NULL, na.strings=\"NA\", stringsAsFactors=FALSE, sep=\",\", dec=\".\",colClasses=\"character\")\n#omkoding\nbarn$tabellvariabel[barn$barnikommune==\"barn_ellers\"&barn$bhgalder==\"1_5\"&barn$enhet==\"personer\"]=barn$tabellvariabel[barn$barnikommune==\"barn_ellers\"&barn$bhgalder==\"1\"&barn$enhet==\"personer\"]\n#løses ved å beregne residual for barn ellers ett år personer. gir 16 NA, som prikkes som manglende data.\nbarn$tabellvariabel[barn$barnikommune==\"barn_ellers\"&barn$bhgalder==\"1\"&barn$enhet==\"personer\"] = as.numeric(barn$tabellvariabel[barn$barnikommune==\"barn_ellers\"&barn$bhgalder==\"1_5\"&barn$enhet==\"personer\"])-as.numeric(barn$tabellvariabel[barn$barnikommune==\"barn_ellers\"&barn$bhgalder==\"2\"&barn$enhet==\"personer\"])-as.numeric(barn$tabellvariabel[barn$barnikommune==\"barn_ellers\"&barn$bhgalder==\"3\"&barn$enhet==\"personer\"])-as.numeric(barn$tabellvariabel[barn$barnikommune==\"barn_ellers\"&barn$bhgalder==\"4\"&barn$enhet==\"personer\"])-as.numeric(barn$tabellvariabel[barn$barnikommune==\"barn_ellers\"&barn$bhgalder==\"5\"&barn$enhet==\"personer\"])\nsum(is.na(barn$tabellvariabel))\nbarn$tabellvariabel[is.na(barn$tabellvariabel)==T] = \".\"\nsum(is.na(barn$tabellvariabel))\n#sjekk visuelt\ndf = subset(barn,barnikommune==\"barn_ellers\"&bhgalder==\"1_5\"&enhet==\"personer\")\ndf = subset(barn,barnikommune==\"barn_ellers\"&bhgalder==\"1\"&enhet==\"personer\")\n#må da også beregne prosent på nytt\n#viser seg at det er store avvik i tallene, har spurt SSB om oppklaring.\ndf = spread(barn,barnikommune,tabellvariabel)\ndf = spread(df,enhet,tabellvariabel)\n\nbarn$tabellvariabel[barn$barnikommune==\"barn_ellers\"&barn$bhgalder==\"1_5\"&barn$enhet==\"prosent\"] = as.numeric(barn$tabellvariabel[barn$barnikommune==\"barn_ellers\"&barn$bhgalder==\"1_5\"&barn$enhet==\"personer\"])/as.numeric(barn$tabellvariabel[barn$barnikommune==\"alle\"&barn$bhgalder==\"1_5\"&barn$enhet==\"personer\"])\nbarn$tabellvariabel[barn$barnikommune==\"barn_ellers\"&barn$bhgalder==\"1\"&barn$enhet==\"prosent\"] = as.numeric(barn$tabellvariabel[barn$barnikommune==\"barn_ellers\"&barn$bhgalder==\"1\"&barn$enhet==\"personer\"])/as.numeric(barn$tabellvariabel[barn$barnikommune==\"alle\"&barn$bhgalder==\"1\"&barn$enhet==\"personer\"])\nbarn$tabellvariabel[barn$barnikommune==\"barn_ellers\"&barn$bhgalder==\"2\"&barn$enhet==\"prosent\"] = as.numeric(barn$tabellvariabel[barn$barnikommune==\"barn_ellers\"&barn$bhgalder==\"2\"&barn$enhet==\"personer\"])/as.numeric(barn$tabellvariabel[barn$barnikommune==\"alle\"&barn$bhgalder==\"2\"&barn$enhet==\"personer\"])\nbarn$tabellvariabel[barn$barnikommune==\"barn_ellers\"&barn$bhgalder==\"3\"&barn$enhet==\"prosent\"] = as.numeric(barn$tabellvariabel[barn$barnikommune==\"barn_ellers\"&barn$bhgalder==\"3\"&barn$enhet==\"personer\"])/as.numeric(barn$tabellvariabel[barn$barnikommune==\"alle\"&barn$bhgalder==\"3\"&barn$enhet==\"personer\"])\nbarn$tabellvariabel[barn$barnikommune==\"barn_ellers\"&barn$bhgalder==\"4\"&barn$enhet==\"prosent\"] = as.numeric(barn$tabellvariabel[barn$barnikommune==\"barn_ellers\"&barn$bhgalder==\"4\"&barn$enhet==\"personer\"])/as.numeric(barn$tabellvariabel[barn$barnikommune==\"alle\"&barn$bhgalder==\"4\"&barn$enhet==\"personer\"])\nbarn$tabellvariabel[barn$barnikommune==\"barn_ellers\"&barn$bhgalder==\"5\"&barn$enhet==\"prosent\"] = as.numeric(barn$tabellvariabel[barn$barnikommune==\"barn_ellers\"&barn$bhgalder==\"5\"&barn$enhet==\"personer\"])/as.numeric(barn$tabellvariabel[barn$barnikommune==\"alle\"&barn$bhgalder==\"5\"&barn$enhet==\"personer\"])\nsum(is.na(barn$tabellvariabel[barn$barnikommune==\"barn_ellers\"&barn$enhet==\"prosent\"]))\nbarn$tabellvariabel[is.na(barn$tabellvariabel)]=\".\"\n\ndf=subset(barn,enhet==\"prosent\")\ndf = spread(df,barnikommune,tabellvariabel)\n\n#GRUNNSKOLEPOENG\n#26.10.2015\ngrunnskolepoeng <- read.csv(\"D:/R/imdikator-munch/data_flat_input/grunnskolepoeng.csv\", row.names=NULL, na.strings=\"NA\", stringsAsFactors=FALSE)\ndf = subset(grunnskolepoeng,kommune_nr!=\"NULL\",select=-c(bydel_nr,fylke_nr,naringsregion_nr))\n\ndf_test = subset(grunnskolepoeng,bydel_nr!=\"NULL\")\n\n#diagnose:\n#kjønnsfordeling for kommune er ikke uniform (har 0 og 1 for alle, og alle for andre kategorier)\n#vreg3 og invalder er kun tilgjengelig for andre enheter enn kommune, og tegnes ikke ut i grensesnittet\n#skaper det trøbbel at de inngår?\n#løsning 1: økse alt anna enn kjønn, fylle inn manglende kombinasjoner av kjønn med manglende data\n#løsning 2: fylle inn manglende komboer av kjønn, ikke røre noe annet.\n\n#NORSK - PROVER\nnorsk_prover <- read.csv(\"D:/R/imdikator-munch/data_flat_input/norsk_prover.csv\", row.names=NULL, na.strings=\"NA\", stringsAsFactors=FALSE)\n\n#provetype mangler alle\n#spraakniva.alle mangler prosenter\n#løses i excel, lettere å legge sammen der\n\nnorsk_prover <- read.csv(\"D:/R/imdikator-munch/data_crossed_input/norsk_prover-fylke-halvar2014.csv\", row.names=NULL, sep=\";\", dec=\",\", na.strings=\"NA\", stringsAsFactors=FALSE)\n#krysstabell, ikke flat.\n\n#intro avslutning direkte\n#26. oktober\n#utfordringer: dele i to filer, en 8-delt og en 3-delt.\n#kode om prosenter fra \":\" til \".\".\n\n#INTRO_STATUS_ARBUTD\n#27.okt\nintro_status_arbutd <- read.csv(\"D:/R/imdikator-munch/data_crossed_input/intro_status_arbutd-fylke-2011_2013.csv\", row.names=NULL, sep=\";\", dec=\",\", na.strings=\"NA\", stringsAsFactors=FALSE,colClasses = \"character\")\n#17. nov\nintro_status_arbutd <- read.csv(\"D:/R/imdikator-munch/data_crossed_input/intro_status_arbutd-naringsregion-2011_2013.csv\", row.names=NULL, sep=\";\", dec=\",\", na.strings=\"NA\", stringsAsFactors=FALSE,colClasses = \"character\")\n\n#Befolkning_hovedgruppe\n#6. desember 2015\nbefolkning_hovedgruppe <- read.csv(\"D:/R/imdikator-munch/data_flat_input/befolkning_hovedgruppe_B.csv\", row.names=NULL, sep=\";\", dec=\",\", na.strings=\"NA\", stringsAsFactors=FALSE)\n#1. Bydel-ID har feil lengde\n#2. Bydel_nr\n#3. feil sep\nbefolkning_hovedgruppe$bydel_id[nchar(befolkning_hovedgruppe$bydel_id)==1] = paste0(\"0\",befolkning_hovedgruppe$bydel_id[nchar(befolkning_hovedgruppe$bydel_id)==1])\nbefolkning_hovedgruppe$bydel_id[nchar(befolkning_hovedgruppe$bydel_id)==2] = paste0(\"0301\",befolkning_hovedgruppe$bydel_id[nchar(befolkning_hovedgruppe$bydel_id)==2])\nnames(befolkning_hovedgruppe)[3] = \"bydel_nr\"\nwrite.csv(befolkning_hovedgruppe,\"D:/R/imdikator-munch/data_flat_output/befolkning_hovedgruppe-bydel-2015.csv\",row.names=F)\nbefolkning_hovedgruppe <- read.csv(\"D:/R/imdikator-munch/data_flat_input/befolkning_hovedgruppe_K.csv\", row.names=NULL, sep=\";\", dec=\",\", na.strings=\"NA\", stringsAsFactors=FALSE)\n#1. kommune-ID har feil lengde\n#2. Bydel_nr\n#3. feil sep\nbefolkning_hovedgruppe = subset(befolkning_hovedgruppe,select=-8)\nbefolkning_hovedgruppe$kommune_id[nchar(befolkning_hovedgruppe$kommune_id)==3] = paste0(\"0\",befolkning_hovedgruppe$kommune_id[nchar(befolkning_hovedgruppe$kommune_id)==3])\nnames(befolkning_hovedgruppe)[3] = \"kommune_nr\"\nwrite.csv(befolkning_hovedgruppe,\"D:/R/imdikator-munch/data_flat_output/befolkning_hovedgruppe-kommune-2015.csv\",row.names=F)\nbefolkning_hovedgruppe <- read.csv(\"D:/R/imdikator-munch/data_flat_input/befolkning_hovedgruppe_N.csv\", row.names=NULL, sep=\";\", dec=\",\", na.strings=\"NA\", stringsAsFactors=FALSE)\n#0. en kolonne for mye\n#1. kommune-ID har feil lengde\n#2. Bydel_nr\n#3. feil sep\nbefolkning_hovedgruppe = subset(befolkning_hovedgruppe,select=-8)\nbefolkning_hovedgruppe$naringsregion_id[nchar(befolkning_hovedgruppe$naringsregion_id)==1] = paste0(\"0\",befolkning_hovedgruppe$naringsregion_id[nchar(befolkning_hovedgruppe$naringsregion_id)==1])\nnames(befolkning_hovedgruppe)[3] = \"naringsregion_nr\"\nwrite.csv(befolkning_hovedgruppe,\"D:/R/imdikator-munch/data_flat_output/befolkning_hovedgruppe-naringsregion-2015.csv\",row.names=F)\nbefolkning_hovedgruppe <- read.csv(\"D:/R/imdikator-munch/data_flat_input/befolkning_hovedgruppe_F.csv\", row.names=NULL, sep=\";\", dec=\",\", na.strings=\"NA\", stringsAsFactors=FALSE)\n#0. en kolonne for mye\n#1. kommune-ID har feil lengde\n#2. Bydel_nr\n#3. feil sep\n#4. nasjonstall lagret i egen fil\nbefolkning_hovedgruppe = subset(befolkning_hovedgruppe,select=-8)\nbefolkning_hovedgruppe$fylke_id[nchar(befolkning_hovedgruppe$fylke_id)==1] = paste0(\"0\",befolkning_hovedgruppe$fylke_id[nchar(befolkning_hovedgruppe$fylke_id)==1])\nnames(befolkning_hovedgruppe)[3] = \"fylke_nr\"\nbefolkning_hovedgruppe_norge <- read.csv(\"D:/R/imdikator-munch/data_flat_input/befolkning_hovedgruppe_L.csv\", row.names=NULL, sep=\";\", dec=\",\", na.strings=\"NA\", stringsAsFactors=FALSE)\nbefolkning_hovedgruppe_norge = subset(befolkning_hovedgruppe_norge,select=-8)\nbefolkning_hovedgruppe_norge$fylke_id[nchar(befolkning_hovedgruppe_norge$fylke_id)==1] = paste0(\"0\",befolkning_hovedgruppe_norge$fylke_id[nchar(befolkning_hovedgruppe_norge$fylke_id)==1])\nnames(befolkning_hovedgruppe_norge)[3] = \"fylke_nr\"\nbefolkning_hovedgruppe = rbind(befolkning_hovedgruppe,befolkning_hovedgruppe_norge)\nwrite.csv(befolkning_hovedgruppe,\"D:/R/imdikator-munch/data_flat_output/befolkning_hovedgruppe-fylke-2015.csv\",row.names=F)\n\n#BEfolkning_innvandringsgrunn\n#6. desember 2015\nbefolkning_innvandringsgrunn <- read.csv(\"D:/R/imdikator-munch/data_flat_input/befolkning_innvandringsgrunn_B_2014.csv\", row.names=NULL, sep=\";\", dec=\",\", na.strings=\"NA\", stringsAsFactors=FALSE)\n#0. en kolonne for mye\n#1. Bydel-ID har feil lengde\n#2. Bydel_nr\n#3. feil sep\n#4. innvgrunn_6 har tomme verdier\nbefolkning_innvandringsgrunn = subset(befolkning_innvandringsgrunn,select=-8)\nbefolkning_innvandringsgrunn$bydel_id[nchar(befolkning_innvandringsgrunn$bydel_id)==1] = paste0(\"0\",befolkning_innvandringsgrunn$bydel_id[nchar(befolkning_innvandringsgrunn$bydel_id)==1])\nbefolkning_innvandringsgrunn$bydel_id[nchar(befolkning_innvandringsgrunn$bydel_id)==2] = paste0(\"0301\",befolkning_innvandringsgrunn$bydel_id[nchar(befolkning_innvandringsgrunn$bydel_id)==2])\nnames(befolkning_innvandringsgrunn)[3] = \"bydel_nr\"\nlevels(as.factor(befolkning_innvandringsgrunn$innvgrunn_6))\nbefolkning_innvandringsgrunn = subset(befolkning_innvandringsgrunn,innvgrunn_6!=\" \")\nwrite.csv(befolkning_innvandringsgrunn,\"D:/R/imdikator-munch/data_flat_output/befolkning_innvandringsgrunn-bydel-2014.csv\",row.names=F)\n#2015\nbefolkning_innvandringsgrunn <- read.csv(\"D:/R/imdikator-munch/data_flat_input/befolkning_innvandringsgrunn_B_2015.csv\", row.names=NULL, sep=\";\", dec=\",\", na.strings=\"NA\", stringsAsFactors=FALSE)\n#0. en kolonne for mye\n#1. Bydel-ID har feil lengde\n#2. Bydel_nr\n#3. feil sep\n#4. innvgrunn_6 har tomme verdier\nbefolkning_innvandringsgrunn = subset(befolkning_innvandringsgrunn,select=-8)\nbefolkning_innvandringsgrunn$bydel_id[nchar(befolkning_innvandringsgrunn$bydel_id)==1] = paste0(\"0\",befolkning_innvandringsgrunn$bydel_id[nchar(befolkning_innvandringsgrunn$bydel_id)==1])\nbefolkning_innvandringsgrunn$bydel_id[nchar(befolkning_innvandringsgrunn$bydel_id)==2] = paste0(\"0301\",befolkning_innvandringsgrunn$bydel_id[nchar(befolkning_innvandringsgrunn$bydel_id)==2])\nnames(befolkning_innvandringsgrunn)[3] = \"bydel_nr\"\nlevels(as.factor(befolkning_innvandringsgrunn$innvgrunn_6))\nbefolkning_innvandringsgrunn = subset(befolkning_innvandringsgrunn,innvgrunn_6!=\" \")\nwrite.csv(befolkning_innvandringsgrunn,\"D:/R/imdikator-munch/data_flat_output/befolkning_innvandringsgrunn-bydel-2015.csv\",row.names=F)\n\n#2014-kommune\nbefolkning_innvandringsgrunn <- read.csv(\"D:/R/imdikator-munch/data_flat_input/befolkning_innvandringsgrunn_K_2014.csv\", row.names=NULL, sep=\";\", dec=\",\", na.strings=\"NA\", stringsAsFactors=FALSE)\n#0. en kolonne for mye\n#1. Bydel-ID har feil lengde\n#2. Bydel_nr\n#3. feil sep\n#4. innvgrunn_6 har tomme verdier\nbefolkning_innvandringsgrunn = subset(befolkning_innvandringsgrunn,select=-8)\nbefolkning_innvandringsgrunn$kommune_id[nchar(befolkning_innvandringsgrunn$kommune_id)==3] = paste0(\"0\",befolkning_innvandringsgrunn$kommune_id[nchar(befolkning_innvandringsgrunn$kommune_id)==3])\nnames(befolkning_innvandringsgrunn)[3] = \"kommune_nr\"\nlevels(as.factor(befolkning_innvandringsgrunn$innvgrunn_6))\nbefolkning_innvandringsgrunn = subset(befolkning_innvandringsgrunn,innvgrunn_6!=\" \")\nwrite.csv(befolkning_innvandringsgrunn,\"D:/R/imdikator-munch/data_flat_output/befolkning_innvandringsgrunn-kommune-2014.csv\",row.names=F)\n\n#2015-kommune\nbefolkning_innvandringsgrunn <- read.csv(\"D:/R/imdikator-munch/data_flat_input/befolkning_innvandringsgrunn_K_2015.csv\", row.names=NULL, sep=\";\", dec=\",\", na.strings=\"NA\", stringsAsFactors=FALSE)\n#0. en kolonne for mye\n#1. Bydel-ID har feil lengde\n#2. Bydel_nr\n#3. feil sep\n#4. innvgrunn_6 har tomme verdier\nbefolkning_innvandringsgrunn = subset(befolkning_innvandringsgrunn,select=-8)\nbefolkning_innvandringsgrunn$kommune_id[nchar(befolkning_innvandringsgrunn$kommune_id)==3] = paste0(\"0\",befolkning_innvandringsgrunn$kommune_id[nchar(befolkning_innvandringsgrunn$kommune_id)==3])\nnames(befolkning_innvandringsgrunn)[3] = \"kommune_nr\"\nlevels(as.factor(befolkning_innvandringsgrunn$innvgrunn_6))\nbefolkning_innvandringsgrunn = subset(befolkning_innvandringsgrunn,innvgrunn_6!=\" \")\nwrite.csv(befolkning_innvandringsgrunn,\"D:/R/imdikator-munch/data_flat_output/befolkning_innvandringsgrunn-kommune-2015.csv\",row.names=F)\n\n#2014-næringsregion\nbefolkning_innvandringsgrunn <- read.csv(\"D:/R/imdikator-munch/data_flat_input/befolkning_innvandringsgrunn_N_2014.csv\", row.names=NULL, sep=\";\", dec=\",\", na.strings=\"NA\", stringsAsFactors=FALSE)\n#0. en kolonne for mye\n#1. Bydel-ID har feil lengde\n#2. Bydel_nr\n#3. feil sep\n#4. innvgrunn_6 har tomme verdier\nbefolkning_innvandringsgrunn = subset(befolkning_innvandringsgrunn,select=-8)\nbefolkning_innvandringsgrunn$naringsregion_id[nchar(befolkning_innvandringsgrunn$naringsregion_id)==1] = paste0(\"0\",befolkning_innvandringsgrunn$naringsregion_id[nchar(befolkning_innvandringsgrunn$naringsregion_id)==1])\nnames(befolkning_innvandringsgrunn)[3] = \"naringsregion_nr\"\nlevels(as.factor(befolkning_innvandringsgrunn$innvgrunn_6))\nbefolkning_innvandringsgrunn = subset(befolkning_innvandringsgrunn,innvgrunn_6!=\" \")\nwrite.csv(befolkning_innvandringsgrunn,\"D:/R/imdikator-munch/data_flat_output/befolkning_innvandringsgrunn-naringsregion-2014.csv\",row.names=F)\n\n#2015-næringsregion\nbefolkning_innvandringsgrunn <- read.csv(\"D:/R/imdikator-munch/data_flat_input/befolkning_innvandringsgrunn_N_2015.csv\", row.names=NULL, sep=\";\", dec=\",\", na.strings=\"NA\", stringsAsFactors=FALSE)\n#0. en kolonne for mye\n#1. Bydel-ID har feil lengde\n#2. Bydel_nr\n#3. feil sep\n#4. innvgrunn_6 har tomme verdier\nbefolkning_innvandringsgrunn = subset(befolkning_innvandringsgrunn,select=-8)\nbefolkning_innvandringsgrunn$naringsregion_id[nchar(befolkning_innvandringsgrunn$naringsregion_id)==1] = paste0(\"0\",befolkning_innvandringsgrunn$naringsregion_id[nchar(befolkning_innvandringsgrunn$naringsregion_id)==1])\nnames(befolkning_innvandringsgrunn)[3] = \"naringsregion_nr\"\nlevels(as.factor(befolkning_innvandringsgrunn$innvgrunn_6))\nbefolkning_innvandringsgrunn = subset(befolkning_innvandringsgrunn,innvgrunn_6!=\" \")\nwrite.csv(befolkning_innvandringsgrunn,\"D:/R/imdikator-munch/data_flat_output/befolkning_innvandringsgrunn-naringsregion-2015.csv\",row.names=F)\n\n#2014-fylke\nbefolkning_innvandringsgrunn <- read.csv(\"D:/R/imdikator-munch/data_flat_input/befolkning_innvandringsgrunn_F_2014.csv\", row.names=NULL, sep=\";\", dec=\",\", na.strings=\"NA\", stringsAsFactors=FALSE)\n#0. en kolonne for mye\n#1. Bydel-ID har feil lengde\n#2. Bydel_nr\n#3. feil sep\n#4. innvgrunn_6 har tomme verdier\n#5. mangler nasjonale tall\nbefolkning_innvandringsgrunn = subset(befolkning_innvandringsgrunn,select=-8)\nbefolkning_innvandringsgrunn$fylke_id[nchar(befolkning_innvandringsgrunn$fylke_id)==1] = paste0(\"0\",befolkning_innvandringsgrunn$fylke_id[nchar(befolkning_innvandringsgrunn$fylke_id)==1])\nnames(befolkning_innvandringsgrunn)[3] = \"fylke_nr\"\nlevels(as.factor(befolkning_innvandringsgrunn$innvgrunn_6))\nbefolkning_innvandringsgrunn = subset(befolkning_innvandringsgrunn,innvgrunn_6!=\" \")\nbefolkning_innvandringsgrunn_norge <- read.csv(\"D:/R/imdikator-munch/data_flat_input/befolkning_innvandringsgrunn_L_2014.csv\", row.names=NULL, sep=\";\", dec=\",\", na.strings=\"NA\", stringsAsFactors=FALSE)\nbefolkning_innvandringsgrunn_norge = subset(befolkning_innvandringsgrunn_norge,select=-8)\nbefolkning_innvandringsgrunn_norge$fylke_id[nchar(befolkning_innvandringsgrunn_norge$fylke_id)==1] = paste0(\"0\",befolkning_innvandringsgrunn_norge$fylke_id[nchar(befolkning_innvandringsgrunn_norge$fylke_id)==1])\nnames(befolkning_innvandringsgrunn_norge)[3] = \"fylke_nr\"\nlevels(as.factor(befolkning_innvandringsgrunn_norge$innvgrunn_6))\nbefolkning_innvandringsgrunn_norge = subset(befolkning_innvandringsgrunn_norge,innvgrunn_6!=\" \")\nbefolkning_innvandringsgrunn = rbind(befolkning_innvandringsgrunn,befolkning_innvandringsgrunn_norge)\nwrite.csv(befolkning_innvandringsgrunn,\"D:/R/imdikator-munch/data_flat_output/befolkning_innvandringsgrunn-fylke-2014.csv\",row.names=F)\n\n#2015-fylke\nbefolkning_innvandringsgrunn <- read.csv(\"D:/R/imdikator-munch/data_flat_input/befolkning_innvandringsgrunn_F_2015.csv\", row.names=NULL, sep=\";\", dec=\",\", na.strings=\"NA\", stringsAsFactors=FALSE)\n#0. en kolonne for mye\n#1. Bydel-ID har feil lengde\n#2. Bydel_nr\n#3. feil sep\n#4. innvgrunn_6 har tomme verdier\n#5. mangler nasjonale tall\nbefolkning_innvandringsgrunn = subset(befolkning_innvandringsgrunn,select=-8)\nbefolkning_innvandringsgrunn$fylke_id[nchar(befolkning_innvandringsgrunn$fylke_id)==1] = paste0(\"0\",befolkning_innvandringsgrunn$fylke_id[nchar(befolkning_innvandringsgrunn$fylke_id)==1])\nnames(befolkning_innvandringsgrunn)[3] = \"fylke_nr\"\nlevels(as.factor(befolkning_innvandringsgrunn$innvgrunn_6))\nbefolkning_innvandringsgrunn = subset(befolkning_innvandringsgrunn,innvgrunn_6!=\" \")\nbefolkning_innvandringsgrunn_norge <- read.csv(\"D:/R/imdikator-munch/data_flat_input/befolkning_innvandringsgrunn_L_2015.csv\", row.names=NULL, sep=\";\", dec=\",\", na.strings=\"NA\", stringsAsFactors=FALSE)\nbefolkning_innvandringsgrunn_norge = subset(befolkning_innvandringsgrunn_norge,select=-8)\nbefolkning_innvandringsgrunn_norge$fylke_id[nchar(befolkning_innvandringsgrunn_norge$fylke_id)==1] = paste0(\"0\",befolkning_innvandringsgrunn_norge$fylke_id[nchar(befolkning_innvandringsgrunn_norge$fylke_id)==1])\nnames(befolkning_innvandringsgrunn_norge)[3] = \"fylke_nr\"\nlevels(as.factor(befolkning_innvandringsgrunn_norge$innvgrunn_6))\nbefolkning_innvandringsgrunn_norge = subset(befolkning_innvandringsgrunn_norge,innvgrunn_6!=\" \")\nbefolkning_innvandringsgrunn = rbind(befolkning_innvandringsgrunn,befolkning_innvandringsgrunn_norge)\nwrite.csv(befolkning_innvandringsgrunn,\"D:/R/imdikator-munch/data_flat_output/befolkning_innvandringsgrunn-fylke-2015.csv\",row.names=F)\n\n#BEFOLKNING_OPPRINNELSESLAND\nbefolkning_opprinnelsesland <- read.csv(\"D:/R/imdikator-munch/data_flat_input/befolkning_opprinnelsesland_B.csv\", row.names=NULL, sep=\";\", dec=\",\", na.strings=\"NA\", stringsAsFactors=FALSE)\n#1. Bydel-ID har feil lengde\n#2. Bydel_nr\n#3. feil sep\nlevels(as.factor(befolkning_opprinnelsesland$kjonn))\nbefolkning_opprinnelsesland = subset(befolkning_opprinnelsesland,select=c(-8,-kjonn))\nbefolkning_opprinnelsesland$bydel_id[nchar(befolkning_opprinnelsesland$bydel_id)==1] = paste0(\"0\",befolkning_opprinnelsesland$bydel_id[nchar(befolkning_opprinnelsesland$bydel_id)==1])\nbefolkning_opprinnelsesland$bydel_id[nchar(befolkning_opprinnelsesland$bydel_id)==2] = paste0(\"0301\",befolkning_opprinnelsesland$bydel_id[nchar(befolkning_opprinnelsesland$bydel_id)==2])\nnames(befolkning_opprinnelsesland)[3] = \"bydel_nr\"\nwrite.csv(befolkning_opprinnelsesland,\"D:/R/imdikator-munch/data_flat_output/befolkning_opprinnelsesland-bydel-2015.csv\",row.names=F)\n\n#kommune\nbefolkning_opprinnelsesland <- read.csv(\"D:/R/imdikator-munch/data_flat_input/befolkning_opprinnelsesland_K.csv\", row.names=NULL, sep=\";\", dec=\",\", na.strings=\"NA\", stringsAsFactors=FALSE)\n#1. kommune-ID har feil lengde\n#2. kommune_nr\n#3. feil sep\nlevels(as.factor(befolkning_opprinnelsesland$kjonn))\nbefolkning_opprinnelsesland = subset(befolkning_opprinnelsesland,select=c(-8,-kjonn))\nbefolkning_opprinnelsesland$kommune_id[nchar(befolkning_opprinnelsesland$kommune_id)==3] = paste0(\"0\",befolkning_opprinnelsesland$kommune_id[nchar(befolkning_opprinnelsesland$kommune_id)==3])\nnames(befolkning_opprinnelsesland)[3] = \"kommune_nr\"\nwrite.csv(befolkning_opprinnelsesland,\"D:/R/imdikator-munch/data_flat_output/befolkning_opprinnelsesland-kommune-2015.csv\",row.names=F)\n\n#naringsregion\nbefolkning_opprinnelsesland <- read.csv(\"D:/R/imdikator-munch/data_flat_input/befolkning_opprinnelsesland_N.csv\", row.names=NULL, sep=\";\", dec=\",\", na.strings=\"NA\", stringsAsFactors=FALSE)\n#1. naringsregion-ID har feil lengde\n#2. naringsregion_nr\n#3. feil sep\nlevels(as.factor(befolkning_opprinnelsesland$kjonn))\nbefolkning_opprinnelsesland = subset(befolkning_opprinnelsesland,select=c(-8,-kjonn))\nbefolkning_opprinnelsesland$naringsregion_id[nchar(befolkning_opprinnelsesland$naringsregion_id)==1] = paste0(\"0\",befolkning_opprinnelsesland$naringsregion_id[nchar(befolkning_opprinnelsesland$naringsregion_id)==1])\nnames(befolkning_opprinnelsesland)[3] = \"naringsregion_nr\"\nwrite.csv(befolkning_opprinnelsesland,\"D:/R/imdikator-munch/data_flat_output/befolkning_opprinnelsesland-naringsregion-2015.csv\",row.names=F)\n\n#fylke + land\nbefolkning_opprinnelsesland <- read.csv(\"D:/R/imdikator-munch/data_flat_input/befolkning_opprinnelsesland_F.csv\", row.names=NULL, sep=\";\", dec=\",\", na.strings=\"NA\", stringsAsFactors=FALSE)\n#1. fylke-ID har feil lengde\n#2. fylke_nr\n#3. feil sep\nlevels(as.factor(befolkning_opprinnelsesland$kjonn))\nbefolkning_opprinnelsesland = subset(befolkning_opprinnelsesland,select=c(-8,-kjonn))\nbefolkning_opprinnelsesland$fylke_id[nchar(befolkning_opprinnelsesland$fylke_id)==1] = paste0(\"0\",befolkning_opprinnelsesland$fylke_id[nchar(befolkning_opprinnelsesland$fylke_id)==1])\nnames(befolkning_opprinnelsesland)[3] = \"fylke_nr\"\nbefolkning_opprinnelsesland_norge <- read.csv(\"D:/R/imdikator-munch/data_flat_input/befolkning_opprinnelsesland_L.csv\", row.names=NULL, sep=\";\", dec=\",\", na.strings=\"NA\", stringsAsFactors=FALSE)\nlevels(as.factor(befolkning_opprinnelsesland_norge$kjonn))\nbefolkning_opprinnelsesland_norge = subset(befolkning_opprinnelsesland_norge,select=c(-8,-kjonn))\nbefolkning_opprinnelsesland_norge$fylke_id[nchar(befolkning_opprinnelsesland_norge$fylke_id)==1] = paste0(\"0\",befolkning_opprinnelsesland_norge$fylke_id[nchar(befolkning_opprinnelsesland_norge$fylke_id)==1])\nnames(befolkning_opprinnelsesland_norge)[3] = \"fylke_nr\"\nbefolkning_opprinnelsesland = rbind(befolkning_opprinnelsesland,befolkning_opprinnelsesland_norge)\nwrite.csv(befolkning_opprinnelsesland,\"D:/R/imdikator-munch/data_flat_output/befolkning_opprinnelsesland-fylke-2015.csv\",row.names=F)\n\n#BEFOLKNING_Verdensregion\n#6. desember 2015\n#1. feil tabellnavn\n#2. mangler alle-variabel på vreg_variabel, feil vreg-variabel\n#3. id, ikke nr, feil sep\n#4. land er egen fil, ikke i fylket.\n# en kolonne for mye\n\n#BEFOLKNING_VERDENSREGION_3 - Bydel\nbefolkning_verdensregion_2 <- read.csv(\"D:/R/imdikator-munch/data_flat_input/befolkning_verdensregion_2B.csv\", row.names=NULL, na.strings=\"NA\", stringsAsFactors=FALSE, sep=\";\", dec=\",\")\nbefolkning_verdensregion_2 = subset(befolkning_verdensregion_2,select=-8)\nbefolkning_verdensregion_2$bydel_id[nchar(befolkning_verdensregion_2$bydel_id)==1] = paste0(\"0\",befolkning_verdensregion_2$bydel_id[nchar(befolkning_verdensregion_2$bydel_id)==1])\nbefolkning_verdensregion_2$bydel_id[nchar(befolkning_verdensregion_2$bydel_id)==2] = paste0(\"0301\",befolkning_verdensregion_2$bydel_id[nchar(befolkning_verdensregion_2$bydel_id)==2])\nnames(befolkning_verdensregion_2)[3] = \"bydel_nr\"\nlibrary(tidyr)\ndf=spread(befolkning_verdensregion_2,vreg_2,tabellvariabel)\ndf$alle=extract_numeric(df[,6])+extract_numeric(df[,7])\n#er det innført NA?\nsum(is.na(df$alle))\n#koder denne om til \".\" manglende data\n#samler vreg-variabler til vreg_3\ndf_2=gather(df,vreg_3,tabellvariabel,6:8,na.rm=F)\n#er ny df utvidet med riktig nrow?\nnrow(df_2)==nrow(befolkning_verdensregion_2)+nrow(df)-sum(is.na(df$alle))\nnrow(df_2)==nrow(befolkning_verdensregion_2)+sum(befolkning_verdensregion_2$vreg_2==\"1\")\nsum(df_2$vreg_3==\"alle\")==sum(befolkning_verdensregion_2$vreg_2==1)\n#ingen avvik.\n#anna informasjon som må oppdateres\ndf_2$tabell_navn=\"befolkning_verdensregion_3\"\nwrite.csv(df_2,\"D:/R/imdikator-munch/data_flat_output/befolkning_verdensregion_3-bydel-2015.csv\",row.names=F)\n\n#BEFOLKNING_VERDENSREGION_3 - kommune\nbefolkning_verdensregion_2 <- read.csv(\"D:/R/imdikator-munch/data_flat_input/befolkning_verdensregion_2K.csv\", row.names=NULL, na.strings=\"NA\", stringsAsFactors=FALSE, sep=\";\", dec=\",\")\nbefolkning_verdensregion_2 = subset(befolkning_verdensregion_2,select=-8)\nbefolkning_verdensregion_2$kommune_id[nchar(befolkning_verdensregion_2$kommune_id)==3] = paste0(\"0\",befolkning_verdensregion_2$kommune_id[nchar(befolkning_verdensregion_2$kommune_id)==3])\nnames(befolkning_verdensregion_2)[3] = \"kommune_nr\"\nlibrary(tidyr)\ndf=spread(befolkning_verdensregion_2,vreg_2,tabellvariabel)\ndf$alle=extract_numeric(df[,6])+extract_numeric(df[,7])\n#er det innført NA?\nsum(is.na(df$alle))\ndf_2=gather(df,vreg_3,tabellvariabel,6:8,na.rm=F)\n#er ny df utvidet med riktig nrow?\nnrow(df_2)==nrow(befolkning_verdensregion_2)+nrow(df)-sum(is.na(df$alle))\nnrow(df_2)==nrow(befolkning_verdensregion_2)+sum(befolkning_verdensregion_2$vreg_2==\"1\")\nsum(df_2$vreg_3==\"alle\")==sum(befolkning_verdensregion_2$vreg_2==1)\n#anna informasjon som må oppdateres\ndf_2$tabell_navn=\"befolkning_verdensregion_3\"\nwrite.csv(df_2,\"D:/R/imdikator-munch/data_flat_output/befolkning_verdensregion_3-kommune-2015.csv\",row.names=F)\n\n#BEFOLKNING_VERDENSREGION_3 - naringsregion\nbefolkning_verdensregion_2 <- read.csv(\"D:/R/imdikator-munch/data_flat_input/befolkning_verdensregion_2N.csv\", row.names=NULL, na.strings=\"NA\", stringsAsFactors=FALSE, sep=\";\", dec=\",\")\nbefolkning_verdensregion_2 = subset(befolkning_verdensregion_2,select=-8)\nbefolkning_verdensregion_2$naringsregion_id[nchar(befolkning_verdensregion_2$naringsregion_id)==1] = paste0(\"0\",befolkning_verdensregion_2$naringsregion_id[nchar(befolkning_verdensregion_2$naringsregion_id)==1])\nnames(befolkning_verdensregion_2)[3] = \"naringsregion_nr\"\nlibrary(tidyr)\ndf=spread(befolkning_verdensregion_2,vreg_2,tabellvariabel)\ndf$alle=extract_numeric(df[,6])+extract_numeric(df[,7])\n#er det innført NA?\nsum(is.na(df$alle))\ndf_2=gather(df,vreg_3,tabellvariabel,6:8,na.rm=F)\n#er ny df utvidet med riktig nrow?\nnrow(df_2)==nrow(befolkning_verdensregion_2)+nrow(df)-sum(is.na(df$alle))\nnrow(df_2)==nrow(befolkning_verdensregion_2)+sum(befolkning_verdensregion_2$vreg_2==\"1\")\nsum(df_2$vreg_3==\"alle\")==sum(befolkning_verdensregion_2$vreg_2==1)\n#anna informasjon som må oppdateres\ndf_2$tabell_navn=\"befolkning_verdensregion_3\"\nwrite.csv(df_2,\"D:/R/imdikator-munch/data_flat_output/befolkning_verdensregion_3-naringsregion-2015.csv\",row.names=F)\n\n#BEFOLKNING_VERDENSREGION_3 - fylke\nbefolkning_verdensregion_2 <- read.csv(\"D:/R/imdikator-munch/data_flat_input/befolkning_verdensregion_2F.csv\", row.names=NULL, na.strings=\"NA\", stringsAsFactors=FALSE, sep=\";\", dec=\",\")\nbefolkning_verdensregion_2_norge <- read.csv(\"D:/R/imdikator-munch/data_flat_input/befolkning_verdensregion_2L.csv\", row.names=NULL, na.strings=\"NA\", stringsAsFactors=FALSE, sep=\";\", dec=\",\")\nbefolkning_verdensregion_2 = rbind (befolkning_verdensregion_2,befolkning_verdensregion_2_norge)\nbefolkning_verdensregion_2 = subset(befolkning_verdensregion_2,select=-8)\nbefolkning_verdensregion_2$fylke_id[nchar(befolkning_verdensregion_2$fylke_id)==1] = paste0(\"0\",befolkning_verdensregion_2$fylke_id[nchar(befolkning_verdensregion_2$fylke_id)==1])\nnames(befolkning_verdensregion_2)[3] = \"fylke_nr\"\nlibrary(tidyr)\ndf=spread(befolkning_verdensregion_2,vreg_2,tabellvariabel)\ndf$alle=extract_numeric(df[,6])+extract_numeric(df[,7])\n#er det innført NA?\nsum(is.na(df$alle))\ndf_2=gather(df,vreg_3,tabellvariabel,6:8,na.rm=F)\n#er ny df utvidet med riktig nrow?\nnrow(df_2)==nrow(befolkning_verdensregion_2)+nrow(df)-sum(is.na(df$alle))\nnrow(df_2)==nrow(befolkning_verdensregion_2)+sum(befolkning_verdensregion_2$vreg_2==\"1\")\nsum(df_2$vreg_3==\"alle\")==sum(befolkning_verdensregion_2$vreg_2==1)\n#anna informasjon som må oppdateres\ndf_2$tabell_navn=\"befolkning_verdensregion_3\"\nwrite.csv(df_2,\"D:/R/imdikator-munch/data_flat_output/befolkning_verdensregion_3-fylke-2015.csv\",row.names=F)\n\n#BEFOLKNING_VERDENSREGION_6 - Bydel\nbefolkning_verdensregion_5 <- read.csv(\"D:/R/imdikator-munch/data_flat_input/befolkning_verdensregion_5B.csv\", row.names=NULL, na.strings=\"NA\", stringsAsFactors=FALSE, sep=\";\", dec=\",\",colClasses=\"character\")\nbefolkning_verdensregion_5 = subset(befolkning_verdensregion_5,select=c(-8,-kjonn))\nbefolkning_verdensregion_5$bydel_id[nchar(befolkning_verdensregion_5$bydel_id)==2] = paste0(\"0301\",befolkning_verdensregion_5$bydel_id[nchar(befolkning_verdensregion_5$bydel_id)==2])\nnames(befolkning_verdensregion_5)[3] = \"bydel_nr\"\nlibrary(tidyr)\ndf=spread(befolkning_verdensregion_5,vreg_5,tabellvariabel)\ndf$alle=extract_numeric(df[,5])+extract_numeric(df[,6])+extract_numeric(df[,7])+extract_numeric(df[,8])+extract_numeric(df[,9])\n#er det innført NA?\nsum(is.na(df$alle))\ndf_2=gather(df,vreg_6,tabellvariabel,5:10,na.rm=F)\n#er ny df utvidet med riktig nrow?\nnrow(df_2)==nrow(befolkning_verdensregion_5)+nrow(df)-sum(is.na(df$alle))\nnrow(df_2)==nrow(befolkning_verdensregion_5)+sum(befolkning_verdensregion_5$vreg_5==\"afrika\")\nsum(df_2$vreg_6==\"alle\")==sum(befolkning_verdensregion_5$vreg_5==\"afrika\")\n#ingen avvik.\n#anna informasjon som må oppdateres\ndf_2$tabell_navn=\"befolkning_verdensregion_6\"\nwrite.csv(df_2,\"D:/R/imdikator-munch/data_flat_output/befolkning_verdensregion_6-bydel-2015.csv\",row.names=F)\n\n#BEFOLKNING_VERDENSREGION_6 - kommune\nbefolkning_verdensregion_5 <- read.csv(\"D:/R/imdikator-munch/data_flat_input/befolkning_verdensregion_5K.csv\", row.names=NULL, na.strings=\"NA\", stringsAsFactors=FALSE, sep=\";\", dec=\",\",colClasses=\"character\")\nbefolkning_verdensregion_5 = subset(befolkning_verdensregion_5,select=c(-8,-kjonn))\nnames(befolkning_verdensregion_5)[3] = \"kommune_nr\"\nlibrary(tidyr)\ndf=spread(befolkning_verdensregion_5,vreg_5,tabellvariabel)\ndf$alle=extract_numeric(df[,5])+extract_numeric(df[,6])+extract_numeric(df[,7])+extract_numeric(df[,8])+extract_numeric(df[,9])\n#er det innført NA?\nsum(is.na(df$alle))\ndf_2=gather(df,vreg_6,tabellvariabel,5:10,na.rm=F)\n#er ny df utvidet med riktig nrow?\nnrow(df_2)==nrow(befolkning_verdensregion_5)+nrow(df)-sum(is.na(df$alle))\nnrow(df_2)==nrow(befolkning_verdensregion_5)+sum(befolkning_verdensregion_5$vreg_5==\"afrika\")\nsum(df_2$vreg_6==\"alle\")==sum(befolkning_verdensregion_5$vreg_5==\"afrika\")\n#ingen avvik.\n#anna informasjon som må oppdateres\ndf_2$tabell_navn=\"befolkning_verdensregion_6\"\nwrite.csv(df_2,\"D:/R/imdikator-munch/data_flat_output/befolkning_verdensregion_6-kommune-2015.csv\",row.names=F)\n\n#BEFOLKNING_VERDENSREGION_6 - naringsregion\nbefolkning_verdensregion_5 <- read.csv(\"D:/R/imdikator-munch/data_flat_input/befolkning_verdensregion_5N.csv\", row.names=NULL, na.strings=\"NA\", stringsAsFactors=FALSE, sep=\";\", dec=\",\",colClasses=\"character\")\nbefolkning_verdensregion_5 = subset(befolkning_verdensregion_5,select=c(-8,-kjonn))\nnames(befolkning_verdensregion_5)[3] = \"naringsregion_nr\"\nlibrary(tidyr)\ndf=spread(befolkning_verdensregion_5,vreg_5,tabellvariabel)\ndf$alle=extract_numeric(df[,5])+extract_numeric(df[,6])+extract_numeric(df[,7])+extract_numeric(df[,8])+extract_numeric(df[,9])\n#er det innført NA?\nsum(is.na(df$alle))\ndf_2=gather(df,vreg_6,tabellvariabel,5:10,na.rm=F)\n#er ny df utvidet med riktig nrow?\nnrow(df_2)==nrow(befolkning_verdensregion_5)+nrow(df)-sum(is.na(df$alle))\nnrow(df_2)==nrow(befolkning_verdensregion_5)+sum(befolkning_verdensregion_5$vreg_5==\"afrika\")\nsum(df_2$vreg_6==\"alle\")==sum(befolkning_verdensregion_5$vreg_5==\"afrika\")\n#ingen avvik.\n#anna informasjon som må oppdateres\ndf_2$tabell_navn=\"befolkning_verdensregion_6\"\nwrite.csv(df_2,\"D:/R/imdikator-munch/data_flat_output/befolkning_verdensregion_6-naringsregion-2015.csv\",row.names=F)\n\n#BEFOLKNING_VERDENSREGION_6 - fylke + landet\nbefolkning_verdensregion_5 <- read.csv(\"D:/R/imdikator-munch/data_flat_input/befolkning_verdensregion_5F.csv\", row.names=NULL, na.strings=\"NA\", stringsAsFactors=FALSE, sep=\";\", dec=\",\",colClasses=\"character\")\nbefolkning_verdensregion_5_norge <- read.csv(\"D:/R/imdikator-munch/data_flat_input/befolkning_verdensregion_5L.csv\", row.names=NULL, na.strings=\"NA\", stringsAsFactors=FALSE, sep=\";\", dec=\",\",colClasses=\"character\")\nbefolkning_verdensregion_5=rbind(befolkning_verdensregion_5,befolkning_verdensregion_5_norge)\nbefolkning_verdensregion_5 = subset(befolkning_verdensregion_5,select=c(-8,-kjonn))\nnames(befolkning_verdensregion_5)[3] = \"fylke_nr\"\nlibrary(tidyr)\ndf=spread(befolkning_verdensregion_5,vreg_5,tabellvariabel)\ndf$alle=extract_numeric(df[,5])+extract_numeric(df[,6])+extract_numeric(df[,7])+extract_numeric(df[,8])+extract_numeric(df[,9])\n#er det innført NA?\nsum(is.na(df$alle))\ndf_2=gather(df,vreg_6,tabellvariabel,5:10,na.rm=F)\n#er ny df utvidet med riktig nrow?\nnrow(df_2)==nrow(befolkning_verdensregion_5)+nrow(df)-sum(is.na(df$alle))\nnrow(df_2)==nrow(befolkning_verdensregion_5)+sum(befolkning_verdensregion_5$vreg_5==\"afrika\")\nsum(df_2$vreg_6==\"alle\")==sum(befolkning_verdensregion_5$vreg_5==\"afrika\")\n#ingen avvik.\n#anna informasjon som må oppdateres\ndf_2$tabell_navn=\"befolkning_verdensregion_6\"\nwrite.csv(df_2,\"D:/R/imdikator-munch/data_flat_output/befolkning_verdensregion_6-fylke-2015.csv\",row.names=F)\n\n#BEFOLKNING-VERDENSREGION-9 - bydel\n#6. desember\nbefolkning_verdensregion_9 <- read.csv(\"D:/R/imdikator-munch/data_flat_input/befolkning_verdensregion_9B.csv\", row.names=NULL, na.strings=\"NA\", stringsAsFactors=FALSE, sep=\";\", dec=\",\",colClasses=\"character\")\nbefolkning_verdensregion_9 = subset(befolkning_verdensregion_9,select=c(-8,-kjonn))\nbefolkning_verdensregion_9$bydel_id[nchar(befolkning_verdensregion_9$bydel_id)==2] = paste0(\"0301\",befolkning_verdensregion_9$bydel_id[nchar(befolkning_verdensregion_9$bydel_id)==2])\nnames(befolkning_verdensregion_9)[3] = \"bydel_nr\"\nbefolkning_verdensregion_9$tabell_navn=\"befolkning_verdensregion_9\"\nwrite.csv(befolkning_verdensregion_9,\"D:/R/imdikator-munch/data_flat_output/befolkning_verdensregion_9-bydel-2015.csv\",row.names=F)\n\n#BEFOLKNING-VERDENSREGION-9 - kommune\n#6. desember\nbefolkning_verdensregion_9 <- read.csv(\"D:/R/imdikator-munch/data_flat_input/befolkning_verdensregion_9K.csv\", row.names=NULL, na.strings=\"NA\", stringsAsFactors=FALSE, sep=\";\", dec=\",\",colClasses=\"character\")\nbefolkning_verdensregion_9 = subset(befolkning_verdensregion_9,select=c(-8,-kjonn))\nnames(befolkning_verdensregion_9)[3] = \"kommune_nr\"\nbefolkning_verdensregion_9$tabell_navn=\"befolkning_verdensregion_9\"\nwrite.csv(befolkning_verdensregion_9,\"D:/R/imdikator-munch/data_flat_output/befolkning_verdensregion_9-kommune-2015.csv\",row.names=F)\n\n#BEFOLKNING-VERDENSREGION-9 - naringsregion\n#6. desember\nbefolkning_verdensregion_9 <- read.csv(\"D:/R/imdikator-munch/data_flat_input/befolkning_verdensregion_9N.csv\", row.names=NULL, na.strings=\"NA\", stringsAsFactors=FALSE, sep=\";\", dec=\",\",colClasses=\"character\")\nbefolkning_verdensregion_9 = subset(befolkning_verdensregion_9,select=c(-8,-kjonn))\nnames(befolkning_verdensregion_9)[3] = \"naringsregion_nr\"\nbefolkning_verdensregion_9$tabell_navn=\"befolkning_verdensregion_9\"\nwrite.csv(befolkning_verdensregion_9,\"D:/R/imdikator-munch/data_flat_output/befolkning_verdensregion_9-naringsregion-2015.csv\",row.names=F)\n\n#BEFOLKNING-VERDENSREGION-9 - fylke\n#6. desember\nbefolkning_verdensregion_9 <- read.csv(\"D:/R/imdikator-munch/data_flat_input/befolkning_verdensregion_9F.csv\", row.names=NULL, na.strings=\"NA\", stringsAsFactors=FALSE, sep=\";\", dec=\",\",colClasses=\"character\")\nbefolkning_verdensregion_9_norge <- read.csv(\"D:/R/imdikator-munch/data_flat_input/befolkning_verdensregion_9L.csv\", row.names=NULL, na.strings=\"NA\", stringsAsFactors=FALSE, sep=\";\", dec=\",\",colClasses=\"character\")\nbefolkning_verdensregion_9 = rbind(befolkning_verdensregion_9,befolkning_verdensregion_9_norge)\nbefolkning_verdensregion_9 = subset(befolkning_verdensregion_9,select=c(-8,-kjonn))\nnames(befolkning_verdensregion_9)[3] = \"fylke_nr\"\nbefolkning_verdensregion_9$tabell_navn=\"befolkning_verdensregion_9\"\nwrite.csv(befolkning_verdensregion_9,\"D:/R/imdikator-munch/data_flat_output/befolkning_verdensregion_9-fylke-2015.csv\",row.names=F)\n\n#Befolkning_botid - bydel\n#7. desember 2015\nbefolkning_botid <- read.csv(\"D:/R/imdikator-munch/data_flat_input/befolkning_botid_B_2015.csv\", row.names=NULL, na.strings=\"NA\", stringsAsFactors=FALSE, sep=\";\", dec=\",\",colClasses=\"character\")\n# bydel_id må bli bydel_nr\n# bydel_id = \" \" må ut\n# botid_5 == \" \" må bli \"alle\"\n# person må bli personer\n# bydel_nr må få 0301 foran.\n# tabellnavn skrevet med stor forbokstav\nnames(befolkning_botid)[3] = \"bydel_nr\"\nbefolkning_botid = subset(befolkning_botid,bydel_nr!=\" \")\nbefolkning_botid$bydel_nr[nchar(befolkning_botid$bydel_nr)==2] = paste0(\"0301\",befolkning_botid$bydel_nr[nchar(befolkning_botid$bydel_nr)==2])\nbefolkning_botid$botid_5[befolkning_botid$botid_5==\" \"]=\"alle\"\nbefolkning_botid$tabell_navn=\"befolkning_botid\"\nbefolkning_botid$enhet = \"personer\"\n#logisk sjekk av antall: 18 bydeler x 3 vreg x 4 botid x 1 enhet\nnrow(befolkning_botid)==18*3*4\n#viser seg at det mangler data for botid_5==alle for vreg_3==1 og ==2\ndf=spread(befolkning_botid,botid_5,tabellvariabel,drop=F)\ndf$alle_kopi=df$alle\ndf$alle=extract_numeric(df[,6])+extract_numeric(df[,7])+extract_numeric(df[,8])\ndf = subset(df,select=-alle_kopi)\nsum(is.na(df$alle))\nbefolkning_botid=gather(df,botid_5,tabellvariabel,6:9,na.rm=F)\nwrite.csv(befolkning_botid,\"D:/R/imdikator-munch/data_flat_output/befolkning_botid-bydel-2015.csv\",row.names=F)\n\n#Befolkning_botid - kommune\n#7. desember 2015\nbefolkning_botid <- read.csv(\"D:/R/imdikator-munch/data_flat_input/befolkning_botid_K_2015_v2.csv\", row.names=NULL, na.strings=\"NA\", stringsAsFactors=FALSE, sep=\";\", dec=\",\",colClasses=\"character\")\n# bydel_id må bli bydel_nr\n# bydel_id = \" \" må ut\n# botid_5 == \" \" må bli \"alle\"\n# person må bli personer\n# bydel_nr må få 0301 foran.\n# tabellnavn skrevet med stor forbokstav\n# enhet må bli personer\n# logisk sjekk av innholdet\nnames(befolkning_botid)[3] = \"kommune_nr\"\nbefolkning_botid = subset(befolkning_botid,kommune_nr!=\"NULL\")\nbefolkning_botid$tabell_navn=\"befolkning_botid\"\nbefolkning_botid$enhet = \"personer\"\n#mangler alle-kategori for botid\ndf=spread(befolkning_botid,botid_5,tabellvariabel,drop=F,fill=\".\")\ndf$alle=extract_numeric(df[,6])+extract_numeric(df[,7])+extract_numeric(df[,8])\ndf = subset(df,select=-alle_kopi)\nsum(is.na(df$alle))\ndf$alle[is.na(df$alle)==T]=\".\"\nbefolkning_botid=gather(df,botid_5,tabellvariabel,6:9,na.rm=F)\n#fire botidsnivåer x 3 vreg x 428 kommuner\n4*3*428\nnlevels(as.factor(befolkning_botid$kommune_nr))\nlevels(as.factor(befolkning_botid$vreg_3))\nwrite.csv(befolkning_botid,\"D:/R/imdikator-munch/data_flat_output/befolkning_botid-kommune-2015.csv\",row.names=F)\n\n#Befolkning_botid - naringsregion\n#7. desember 2015\nbefolkning_botid <- read.csv(\"D:/R/imdikator-munch/data_flat_input/befolkning_botid_N_2015.csv\", row.names=NULL, na.strings=\"NA\", stringsAsFactors=FALSE, sep=\";\", dec=\",\",colClasses=\"character\")\n# naringsregion_id = \"NULL\" må ut\n# tabellnavn skrevet med stor forbokstav\n# person må bli personer\n# logisk sjekk av innholdet\n# botid_5 == \" \" må bli \"alle\"\n# vreg_3 == \" \" må bli alle\n# enhet må bli personer\n\nbefolkning_botid = subset(befolkning_botid,naringsregion_nr!=\"NULL\")\nbefolkning_botid$tabell_navn=\"befolkning_botid\"\nbefolkning_botid$enhet = \"personer\"\n#4 botidsnivåer x 3 vregnivåer x 83 nareg\n4*3*83\nlevels(as.factor(befolkning_botid$vreg_3))\nbefolkning_botid$vreg_3[befolkning_botid$vreg_3==\" \"]=\"alle\"\nlevels(as.factor(befolkning_botid$botid_5))\n#mangler alle-kategori for botid for vreg==1 og ==2.\ndf=spread(befolkning_botid,botid_5,tabellvariabel,drop=F)\ndf$alle_kopi=df$alle\ndf$alle=extract_numeric(df[,6])+extract_numeric(df[,7])+extract_numeric(df[,8])\ndf = subset(df,select=-alle_kopi)\nsum(is.na(df$alle))\nbefolkning_botid=gather(df,botid_5,tabellvariabel,6:9,na.rm=F)\n#fire botidsnivåer x 3 vreg x 83 naringsregionr\n4*3*83\nnlevels(as.factor(befolkning_botid$naringsregion_nr))\nwrite.csv(befolkning_botid,\"D:/R/imdikator-munch/data_flat_output/befolkning_botid-naringsregion-2015.csv\",row.names=F)\n\n#Befolkning_botid - fylke\n#7. desember 2015\nbefolkning_botid <- read.csv(\"D:/R/imdikator-munch/data_flat_input/befolkning_botid_F_2015.csv\", row.names=NULL, na.strings=\"NA\", stringsAsFactors=FALSE, sep=\";\", dec=\",\",colClasses=\"character\")\n# tabellnavn skrevet med stor forbokstav\n# person må bli personer\n# logisk sjekk av innholdet\n# botid_5 == \" \" må bli \"alle\"\n# vreg_3 == \" \" må bli alle\n# enhet må bli personer\nbefolkning_botid$tabell_navn=\"befolkning_botid\"\nbefolkning_botid$enhet = \"personer\"\n#4 botidsnivåer x 3 vregnivåer x nlevels(as.factor(befolkning_botid$fylke_nr))\n4*3*20\nlevels(as.factor(befolkning_botid$vreg_3))\nlevels(as.factor(befolkning_botid$botid_5))\n#mangler vreg_3==alle data for botidskategorier\ndf=spread(befolkning_botid,vreg_3,tabellvariabel,drop=F)\ndf$alle_kopi=df$alle\ndf$alle=extract_numeric(df[,6])+extract_numeric(df[,7])\ndf = subset(df,select=-alle_kopi)\nsum(is.na(df$alle))\ndf2=gather(df,vreg_3,tabellvariabel,6:8,na.rm=F)\n#mangler alle-kategori for botid for vreg==1 og ==2.\ndf=spread(df2,botid_5,tabellvariabel,drop=F)\ndf$alle=extract_numeric(df[,6])+extract_numeric(df[,7])+extract_numeric(df[,8])\nsum(is.na(df$alle))\nbefolkning_botid=gather(df,botid_5,tabellvariabel,6:9,na.rm=F)\n#fire botidsnivåer x 3 vreg x 83 fylker\n4*3*20\nwrite.csv(befolkning_botid,\"D:/R/imdikator-munch/data_flat_output/befolkning_botid-fylke-2015.csv\",row.names=F)\n\n#BEFOLKNING_FLYTTING\n#befolkning_flytting - bydel\n#9. desember 2015\nlibrary(tidyr)\nbefolkning_flytting <- read.csv(\"D:/R/imdikator-munch/data_flat_input/befolkning_flytting_B_2014.csv\", row.names=NULL, na.strings=\"NA\", stringsAsFactors=FALSE, sep=\",\", dec=\".\",colClasses=\"character\")\n# bydel_id må bli bydel_nr\n# bydel_nr må få 0301 foran.\n# tabellnavn må bli tabell_navn\n# tabell må splittes i to: en med vreg og en uten vreg\n# invkat2 må bli til invkat_3, dvs. befolkningen_forøvrig = alle-innvandrere\n# invkat_3 må bli innvkat_2\n# logisk sjekk av antall observasjoner etter det\nnames(befolkning_flytting)[1] = \"tabell_navn\"\nnames(befolkning_flytting)[3] = \"bydel_nr\"\nbefolkning_flytting$bydel_nr[nchar(befolkning_flytting$bydel_nr)==2] = paste0(\"0301\",befolkning_flytting$bydel_nr[nchar(befolkning_flytting$bydel_nr)==2])\n\n#befolkning_flytting_vreg\nbefolkning_flytting_vreg = subset(befolkning_flytting,invkat_2 =='innvandrere',select=-invkat_2)\nbefolkning_flytting_vreg$tabell_navn =\"befolkning_flytting_vreg\"\n#logisksjekk: 486 = 3*nlevels(as.factor(befolkning_flytting_vreg$bydel_nr))*nlevels(as.factor(befolkning_flytting_vreg$flytting))\nnrow(befolkning_flytting_vreg)==3*nlevels(as.factor(befolkning_flytting_vreg$bydel_nr))*nlevels(as.factor(befolkning_flytting_vreg$flytting))\nwrite.csv(befolkning_flytting_vreg,\"D:/R/imdikator-munch/data_flat_output/befolkning_flytting_vreg-bydel-2014.csv\",row.names=F)\n\n#befolkning_flytting\nbefolkning_flytting=subset(befolkning_flytting,vreg_3 =='alle',select=-vreg_3)\ndf=spread(befolkning_flytting,invkat_2,tabellvariabel,drop=F)\nsum(is.na(df$alle))\nsum(is.na(df$innvandrere))\ndf$befolkningen_ellers=extract_numeric(df[,6])-extract_numeric(df[,7])\ndf = subset(df,select=-alle_kopi)\nsum(is.na(df$befolkningen_ellers))\nbefolkning_flytting=gather(df,innvkat_3,tabellvariabel,6:8,na.rm=F)\nnrow(befolkning_flytting)==9*3*18\nwrite.csv(befolkning_flytting,\"D:/R/imdikator-munch/data_flat_output/befolkning_flytting-bydel-2014.csv\",row.names=F)\n\n#kommune\nbefolkning_flytting <- read.csv(\"D:/R/imdikator-munch/data_flat_input/befolkning_flytting_K_2014.csv\", row.names=NULL, na.strings=\"NA\", stringsAsFactors=FALSE, sep=\",\", dec=\".\",colClasses=\"character\")\n# tilflyttingskommune må bli kommune_nr\n# tabellnavn må bli tabell_navn\n# tabell må splittes i to: en med vreg og en uten vreg\n# invkat2 må bli til invkat_3, dvs. befolkningen_forøvrig = alle-innvandrere\n# invkat_3 må bli innvkat_2\n# logisk sjekk av antall observasjoner etter det\nnames(befolkning_flytting)[1] = \"tabell_navn\"\nnames(befolkning_flytting)[3] = \"kommune_nr\"\nlevels(as.factor(befolkning_flytting$flytting))\n\n#befolkning_flytting_vreg\nbefolkning_flytting_vreg = subset(befolkning_flytting,invkat_2 =='innvandrere',select=-invkat_2)\nbefolkning_flytting_vreg$tabell_navn =\"befolkning_flytting_vreg\"\n#logisksjekk: \nnrow(befolkning_flytting_vreg)==3*nlevels(as.factor(befolkning_flytting_vreg$kommune_nr))*nlevels(as.factor(befolkning_flytting_vreg$flytting))\nwrite.csv(befolkning_flytting_vreg,\"D:/R/imdikator-munch/data_flat_output/befolkning_flytting_vreg-kommune-2014.csv\",row.names=F)\n\n#befolkning_flytting\nbefolkning_flytting=subset(befolkning_flytting,vreg_3 =='alle',select=-vreg_3)\ndf=spread(befolkning_flytting,invkat_2,tabellvariabel,drop=F)\nsum(is.na(df$alle))\nsum(is.na(df$innvandrere))\ndf$befolkningen_ellers=extract_numeric(df[,6])-extract_numeric(df[,7])\nsum(is.na(df$befolkningen_ellers))\nbefolkning_flytting=gather(df,innvkat_3,tabellvariabel,6:8,na.rm=F)\nnrow(befolkning_flytting)==9*3*428\nwrite.csv(befolkning_flytting,\"D:/R/imdikator-munch/data_flat_output/befolkning_flytting-kommune-2014.csv\",row.names=F)\n\n#naringsregion\nbefolkning_flytting <- read.csv(\"D:/R/imdikator-munch/data_flat_input/befolkning_flytting_N_2014.csv\", row.names=NULL, na.strings=\"NA\", stringsAsFactors=FALSE, sep=\",\", dec=\".\",colClasses=\"character\")\n# tilflyttingsnaringsregion må bli naringsregion_nr\n# tabellnavn må bli tabell_navn\n# tabell må splittes i to: en med vreg og en uten vreg\n# invkat2 må bli til invkat_3, dvs. befolkningen_forøvrig = alle-innvandrere\n# invkat_3 må bli innvkat_2\n# logisk sjekk av antall observasjoner etter det\nnames(befolkning_flytting)[1] = \"tabell_navn\"\nnames(befolkning_flytting)[3] = \"naringsregion_nr\"\nlevels(as.factor(befolkning_flytting$flytting))\n\n#befolkning_flytting_vreg\nbefolkning_flytting_vreg = subset(befolkning_flytting,invkat_2 =='innvandrere',select=-invkat_2)\nbefolkning_flytting_vreg$tabell_navn =\"befolkning_flytting_vreg\"\n#logisksjekk: \nnrow(befolkning_flytting_vreg)==3*83*9\nwrite.csv(befolkning_flytting_vreg,\"D:/R/imdikator-munch/data_flat_output/befolkning_flytting_vreg-naringsregion-2014.csv\",row.names=F)\n\n#befolkning_flytting\nbefolkning_flytting=subset(befolkning_flytting,vreg_3 =='alle',select=-vreg_3)\ndf=spread(befolkning_flytting,invkat_2,tabellvariabel,drop=F)\nsum(is.na(df$alle))\nsum(is.na(df$innvandrere))\ndf$befolkningen_ellers=extract_numeric(df[,6])-extract_numeric(df[,7])\nsum(is.na(df$befolkningen_ellers))\nbefolkning_flytting=gather(df,innvkat_3,tabellvariabel,6:8,na.rm=F)\nnrow(befolkning_flytting)==9*3*83\nwrite.csv(befolkning_flytting,\"D:/R/imdikator-munch/data_flat_output/befolkning_flytting-naringsregion-2014.csv\",row.names=F)\n\n#fylke\nbefolkning_flytting <- read.csv(\"D:/R/imdikator-munch/data_flat_input/befolkning_flytting_FL_2014.csv\", row.names=NULL, na.strings=\"NA\", stringsAsFactors=FALSE, sep=\",\", dec=\".\",colClasses=\"character\")\n# fylke_id må bli fylke_nr\n# tabellnavn må bli tabell_navn\n# fylke = 0 må bli 00\n# tabell må splittes i to: en med vreg og en uten vreg\n# invkat2 må bli til invkat_3, dvs. befolkningen_forøvrig = alle-innvandrere\n# invkat_3 må bli innvkat_2\n# logisk sjekk av antall observasjoner etter det\nnames(befolkning_flytting)[1] = \"tabell_navn\"\nnames(befolkning_flytting)[3] = \"fylke_nr\"\nbefolkning_flytting$fylke_nr[nchar(befolkning_flytting$fylke_nr)==1] = paste0(\"0\",befolkning_flytting$fylke_nr[nchar(befolkning_flytting$fylke_nr)==1])\nlevels(as.factor(befolkning_flytting$flytting))\n\n#befolkning_flytting_vreg\nbefolkning_flytting_vreg = subset(befolkning_flytting,invkat_2 =='innvandrere',select=-invkat_2)\nbefolkning_flytting_vreg$tabell_navn =\"befolkning_flytting_vreg\"\n#logisksjekk: \nnrow(befolkning_flytting_vreg)==3*20*9\nwrite.csv(befolkning_flytting_vreg,\"D:/R/imdikator-munch/data_flat_output/befolkning_flytting_vreg-fylke-2014.csv\",row.names=F)\n\n#befolkning_flytting\nbefolkning_flytting=subset(befolkning_flytting,vreg_3 =='alle',select=-vreg_3)\ndf=spread(befolkning_flytting,invkat_2,tabellvariabel,drop=F)\nsum(is.na(df$alle))\nsum(is.na(df$innvandrere))\ndf$befolkningen_ellers=extract_numeric(df[,6])-extract_numeric(df[,7])\nsum(is.na(df$befolkningen_ellers))\nbefolkning_flytting=gather(df,innvkat_3,tabellvariabel,6:8,na.rm=F)\nnrow(befolkning_flytting)==9*3*20\nwrite.csv(befolkning_flytting,\"D:/R/imdikator-munch/data_flat_output/befolkning_flytting-fylke-2014.csv\",row.names=F)\n\n#FLYKTNING_BOTID_FLYTTING\nflyktning_botid_flytting <- read.csv(\"D:/R/imdikator-munch/data_flat_input/flyktning_botid_flytting_B_2015.csv\", row.names=NULL, na.strings=\"NA\", stringsAsFactors=FALSE, sep=\";\", dec=\",\",colClasses=\"character\")\n# bydel_id må bli bydel_nr\n# fjerne ekstra kolonne\n# kode om 0-4 til 0_4\n# bydeler må få 0301 foran\n# logisk sjekk av antall observasjoner etter det\nnames(flyktning_botid_flytting)[3] = \"bydel_nr\"\nflyktning_botid_flytting$bydel_nr[nchar(flyktning_botid_flytting$bydel_nr)==2] = paste0(\"0301\",flyktning_botid_flytting$bydel_nr[nchar(flyktning_botid_flytting$bydel_nr)==2])\nflyktning_botid_flytting$enhet[flyktning_botid_flytting$enhet==\"person\"]=\"personer\"\nflyktning_botid_flytting = subset(flyktning_botid_flytting,select=-X)\nlevels(as.factor(flyktning_botid_flytting$botid_3))\nlevels(as.factor(flyktning_botid_flytting$forste_bosettingskommune))\nflyktning_botid_flytting$botid_3 = gsub(\"\\\\-\",\"_\",flyktning_botid_flytting$botid_3)\nflyktning_botid_flytting$tabellvariabel = gsub(\"\\\\,\",\".\",flyktning_botid_flytting$tabellvariabel)\n3*4*18*2==nrow(flyktning_botid_flytting)\ndf=spread(flyktning_botid_flytting,botid_3,tabellvariabel,drop=F)\ndf$alle_kopi=df$alle\n#problem med komma som desimaltegn, må gsubbes til punktum lenger opp\ndf$alle=extract_numeric(df[,6])+extract_numeric(df[,7])\ndf$alle=as.numeric(df[,6])+as.numeric(df[,7])\ndf = subset(df,select=-alle_kopi)\nsum(is.na(df$alle))\ndf_2=gather(df,botid_3,tabellvariabel,6:8,na.rm=F)\nwrite.csv(df_2,\"D:/R/imdikator-munch/data_flat_output/flyktning_botid_flytting-bydel-2015.csv\",row.names=F)\n\n#FLYKTNING_BOTID_FLYTTING\n#KOMMUNE\nflyktning_botid_flytting <- read.csv(\"D:/R/imdikator-munch/data_flat_input/flyktning_botid_flytting_K_2015.csv\", row.names=NULL, na.strings=\"NA\", stringsAsFactors=FALSE, sep=\";\", dec=\",\",colClasses=\"character\")\n# kommune_id må bli kommune_nr\n# fjerne ekstra kolonne\n# kode om 0-4 til 0_4\n#problem med komma som desimaltegn, må gsubbes til punktum lenger opp\n# logisk sjekk av antall observasjoner etter det\nnames(flyktning_botid_flytting)[3] = \"kommune_nr\"\nflyktning_botid_flytting$enhet[flyktning_botid_flytting$enhet==\"person\"]=\"personer\"\nflyktning_botid_flytting = subset(flyktning_botid_flytting,select=-X)\nlevels(as.factor(flyktning_botid_flytting$botid_3))\nlevels(as.factor(flyktning_botid_flytting$forste_bosettingskommune))\nflyktning_botid_flytting$botid_3 = gsub(\"\\\\-\",\"_\",flyktning_botid_flytting$botid_3)\nflyktning_botid_flytting$tabellvariabel = gsub(\"\\\\,\",\".\",flyktning_botid_flytting$tabellvariabel)\nnlevels(as.factor(flyktning_botid_flytting$kommune_nr))\n3*4*354*2==nrow(flyktning_botid_flytting)\ndf=spread(flyktning_botid_flytting,botid_3,tabellvariabel,drop=F)\ndf$alle_kopi=df$alle\ndf$alle=extract_numeric(df[,6])+extract_numeric(df[,7])\nsum(is.na(df$alle))\ndf = subset(df,select=-alle_kopi)\nsum(is.na(df$alle))\ndf_2=gather(df,botid_3,tabellvariabel,6:8,na.rm=F)\n3*4*354*2==nrow(df_2)\nwrite.csv(df_2,\"D:/R/imdikator-munch/data_flat_output/flyktning_botid_flytting-kommune-2015.csv\",row.names=F)\n\n#FLYKTNING_BOTID_FLYTTING\n#NÆRINGSREGION\nflyktning_botid_flytting <- read.csv(\"D:/R/imdikator-munch/data_flat_input/flyktning_botid_flytting_N_2015.csv\", row.names=NULL, na.strings=\"NA\", stringsAsFactors=FALSE, sep=\";\", dec=\",\",colClasses=\"character\")\n# naringsregion_id må bli naringsregion_nr\n# fjerne ekstra kolonne\n# kode om 0-4 til 0_4\n#problem med komma som desimaltegn, må gsubbes til punktum lenger opp\n# logisk sjekk av antall observasjoner etter det\nnames(flyktning_botid_flytting)[3] = \"naringsregion_nr\"\nflyktning_botid_flytting$enhet[flyktning_botid_flytting$enhet==\"person\"]=\"personer\"\nflyktning_botid_flytting = subset(flyktning_botid_flytting,select=-X)\nlevels(as.factor(flyktning_botid_flytting$botid_3))\nlevels(as.factor(flyktning_botid_flytting$forste_bosettingskommune))\nflyktning_botid_flytting$botid_3 = gsub(\"\\\\-\",\"_\",flyktning_botid_flytting$botid_3)\nflyktning_botid_flytting$tabellvariabel = gsub(\"\\\\,\",\".\",flyktning_botid_flytting$tabellvariabel)\nnlevels(as.factor(flyktning_botid_flytting$naringsregion_nr))\n3*4*83*2==nrow(flyktning_botid_flytting)\ndf=spread(flyktning_botid_flytting,botid_3,tabellvariabel,drop=F)\ndf$alle_kopi=df$alle\ndf$alle=extract_numeric(df[,6])+extract_numeric(df[,7])\nsum(is.na(df$alle))\ndf = subset(df,select=-alle_kopi)\nsum(is.na(df$alle))\ndf_2=gather(df,botid_3,tabellvariabel,6:8,na.rm=F)\n3*4*83*2==nrow(df_2)\nwrite.csv(df_2,\"D:/R/imdikator-munch/data_flat_output/flyktning_botid_flytting-naringsregion-2015.csv\",row.names=F)\n\n#FLYKTNING_BOTID_FLYTTING\n#FYLKE\nflyktning_botid_flytting <- read.csv(\"D:/R/imdikator-munch/data_flat_input/flyktning_botid_flytting_F_2015.csv\", row.names=NULL, na.strings=\"NA\", stringsAsFactors=FALSE, sep=\";\", dec=\",\",colClasses=\"character\")\nflyktning_botid_flytting_norge <- read.csv(\"D:/R/imdikator-munch/data_flat_input/flyktning_botid_flytting_L_2015.csv\", row.names=NULL, na.strings=\"NA\", stringsAsFactors=FALSE, sep=\";\", dec=\",\",colClasses=\"character\")\nflyktning_botid_flytting = rbind (flyktning_botid_flytting,flyktning_botid_flytting_norge)\n# fylke_id må bli fylke_nr\n# fjerne ekstra kolonne\n# kode om 0-4 til 0_4\n#problem med komma som desimaltegn, må gsubbes til punktum lenger opp\n# logisk sjekk av antall observasjoner etter det\nnames(flyktning_botid_flytting)[3] = \"fylke_nr\"\nflyktning_botid_flytting$enhet[flyktning_botid_flytting$enhet==\"person\"]=\"personer\"\nflyktning_botid_flytting = subset(flyktning_botid_flytting,select=-X)\nlevels(as.factor(flyktning_botid_flytting$botid_3))\nlevels(as.factor(flyktning_botid_flytting$forste_bosettingskommune))\nflyktning_botid_flytting$botid_3 = gsub(\"\\\\-\",\"_\",flyktning_botid_flytting$botid_3)\nflyktning_botid_flytting$tabellvariabel = gsub(\"\\\\,\",\".\",flyktning_botid_flytting$tabellvariabel)\nnlevels(as.factor(flyktning_botid_flytting$fylke_nr))\n3*4*20*2==nrow(flyktning_botid_flytting)\ndf=spread(flyktning_botid_flytting,botid_3,tabellvariabel,drop=F)\ndf$alle_kopi=df$alle\ndf$alle=extract_numeric(df[,6])+extract_numeric(df[,7])\nsum(is.na(df$alle))\ndf = subset(df,select=-alle_kopi)\nsum(is.na(df$alle))\ndf_2=gather(df,botid_3,tabellvariabel,6:8,na.rm=F)\n3*4*20*2==nrow(df_2)\nwrite.csv(df_2,\"D:/R/imdikator-munch/data_flat_output/flyktning_botid_flytting-fylke-2015.csv\",row.names=F)\n\n#SOSIALHJELP\n#10. desember\nsosialhjelp <- read.csv(\"D:/R/imdikator-munch/data_flat_input/sosialhjelp_2013-2014.csv\", row.names=NULL, na.strings=\"NA\", stringsAsFactors=FALSE, sep=\",\", dec=\".\",colClasses=\"character\")\nnlevels(as.factor(sosialhjelp$bydel_nr))-1\nnlevels(as.factor(sosialhjelp$kommune_nr))-1\nnlevels(as.factor(sosialhjelp$naringsregion_nr))-1\nnlevels(as.factor(sosialhjelp$fylke_nr))-1\n#fylke 0 == 00\nsosialhjelp$fylke_nr[sosialhjelp$fylke_nr==\"0\"]=\"00\"\nsosialhjelp$enhet[sosialhjelp$enhet==\"person\"]=\"personer\"\n#logisk sjekk: \nnrow(sosialhjelp)==(18*3*3*2*2)+(428*3*3*2*2)+(83*3*3*2*2)+(20*3*3*2*2)\nwrite.csv(sosialhjelp,\"D:/R/imdikator-munch/data_flat_output/sosialhjelp-alle-2013_2014.csv\",row.names=F)\n\n#GRUNNSKOLEPOENG\n#10. desember\n#bydel - 2014\n# aar er feil - må kodes som siste året i intervallet, avgangsåret.\n# person må bli personer\n# logiske sjekker\ngrunnskolepoeng <- read.csv(\"D:/R/imdikator-munch/data_flat_input/grunnskolepoeng_bydel_2014_ny.csv\", row.names=NULL, na.strings=\"NA\", stringsAsFactors=FALSE, sep=\";\", dec=\",\",colClasses=\"character\")\ngrunnskolepoeng$aar[grunnskolepoeng$aar==\"2013-2014\"]=\"2014\"\ngrunnskolepoeng$enhet[grunnskolepoeng$enhet==\"person\"]=\"personer\"\n#logisk: 18 bydeler, 3 kjønn, 5 innvkat, 4 vreg, 4 invalder\n18*3*5*4*4\nlibrary(tidyr)\ndf=spread(grunnskolepoeng,innvkat_5,tabellvariabel,drop=F)\n#noe må gjøres med denne, kanskje tilsvarende som for flyktninger: skjære ut innvandrere som vi har mer informasjon om til egen tabell\n#kun hvis deler er lopsided, blir ulike headergroups? hvis ikke...\n\nnlevels(as.factor(grunnskolepoeng$bydel_nr))\ndf_grunn = subset(grunnskolepoeng,subset=c((vreg_3==\"alle\"|vreg_3==\"NULL\")&(invalder_3==\"alle\"|invalder_3==\"NULL\")))\ngrunnskolepoeng_innvkat5 = subset(df_grunn,select=-c(vreg_3,invalder_3))\n#1: grunnsettet - 17 bydeler * 3 kjønn * 5innvkat * 2 enheter\nnrow(grunnskolepoeng_innvkat5)==17*3*5*2\nwrite.csv(grunnskolepoeng_innvkat5,\"D:/R/imdikator-munch/data_flat_output/grunnskolepoeng-bydel-2014.csv\",row.names=F)\n\n#setter opp en ny tabell med tabell_navn grunnskolepoeng_innvandrere\ndf_innv = subset(grunnskolepoeng,subset=c(vreg_3!=\"NULL\"|invalder_3!=\"NULL\"))\ngrunnskolepoeng_innvandrere = subset(df_innv,select=-innvkat_5)\nnrow(grunnskolepoeng_innvandrere)==17*3*1*3*3*2\ngrunnskolepoeng_innvandrere$tabell_navn=\"grunnskolepoeng_innvandrere\"\nwrite.csv(grunnskolepoeng_innvandrere,\"D:/R/imdikator-munch/data_flat_output/grunnskolepoeng_innvandrere-bydel-2014.csv\",row.names=F)\n\n#alle observasjoner er her, men hva skjer ved innlesning? Får vi headergroups som kan brukes?\n#svaret er nei: innleseren leser headergroups ut fra hva som er gyldig og hva som har null\n#men det gir en headergroup for innvandrere og en for de andre.\n\n#bydel - 2015\n# aar er feil - må kodes som siste året i intervallet, avgangsåret.\n# person må bli personer\n# logiske sjekker\ngrunnskolepoeng <- read.csv(\"D:/R/imdikator-munch/data_flat_input/grunnskolepoeng_bydel_2015_ny.csv\", row.names=NULL, na.strings=\"NA\", stringsAsFactors=FALSE, sep=\";\", dec=\",\",colClasses=\"character\")\ngrunnskolepoeng$aar[grunnskolepoeng$aar==\"2014-2015\"]=\"2015\"\ngrunnskolepoeng$enhet[grunnskolepoeng$enhet==\"person\"]=\"personer\"\nnlevels(as.factor(grunnskolepoeng$bydel_nr))\ndf_grunn = subset(grunnskolepoeng,subset=c((vreg_3==\"alle\"|vreg_3==\"NULL\")&(invalder_3==\"alle\"|invalder_3==\"NULL\")))\ngrunnskolepoeng_innvkat5 = subset(df_grunn,select=-c(vreg_3,invalder_3))\nnrow(grunnskolepoeng_innvkat5)==17*3*5*2\nwrite.csv(grunnskolepoeng_innvkat5,\"D:/R/imdikator-munch/data_flat_output/grunnskolepoeng-bydel-2015.csv\",row.names=F)\n\ndf_innv = subset(grunnskolepoeng,subset=c(vreg_3!=\"NULL\"|invalder_3!=\"NULL\"))\ngrunnskolepoeng_innvandrere = subset(df_innv,select=-innvkat_5)\nnrow(grunnskolepoeng_innvandrere)==17*3*1*3*3*2\ngrunnskolepoeng_innvandrere$tabell_navn=\"grunnskolepoeng_innvandrere\"\nwrite.csv(grunnskolepoeng_innvandrere,\"D:/R/imdikator-munch/data_flat_output/grunnskolepoeng_innvandrere-bydel-2015.csv\",row.names=F)\n\n#kommune - 2014\n# aar er feil - må kodes som siste året i intervallet, avgangsåret.\n# person må bli personer\n# logiske sjekker\ngrunnskolepoeng <- read.csv(\"D:/R/imdikator-munch/data_flat_input/grunnskolepoeng_kommune_2014_ny.csv\", row.names=NULL, na.strings=\"NA\", stringsAsFactors=FALSE, sep=\";\", dec=\",\",colClasses=\"character\")\ngrunnskolepoeng$aar[grunnskolepoeng$aar==\"2013-2014\"]=\"2014\"\ngrunnskolepoeng$enhet[grunnskolepoeng$enhet==\"person\"]=\"personer\"\nnlevels(as.factor(grunnskolepoeng$kommune_nr))\ndf_grunn = subset(grunnskolepoeng,subset=c((vreg_3==\"alle\"|vreg_3==\"NULL\")&(invalder_3==\"alle\"|invalder_3==\"NULL\")))\ngrunnskolepoeng_innvkat5 = subset(df_grunn,select=-c(vreg_3,invalder_3))\nnrow(grunnskolepoeng_innvkat5)==427*3*5*2\nwrite.csv(grunnskolepoeng_innvkat5,\"D:/R/imdikator-munch/data_flat_output/grunnskolepoeng-kommune-2014.csv\",row.names=F)\n\ndf_innv = subset(grunnskolepoeng,subset=c(vreg_3!=\"NULL\"|invalder_3!=\"NULL\"))\ngrunnskolepoeng_innvandrere = subset(df_innv,select=-innvkat_5)\nnrow(grunnskolepoeng_innvandrere)==427*3*1*3*3*2\ngrunnskolepoeng_innvandrere$tabell_navn=\"grunnskolepoeng_innvandrere\"\nwrite.csv(grunnskolepoeng_innvandrere,\"D:/R/imdikator-munch/data_flat_output/grunnskolepoeng_innvandrere-kommune-2014.csv\",row.names=F)\n\n#kommune - 2015\n# aar er feil - må kodes som siste året i intervallet, avgangsåret.\n# person må bli personer\n# logiske sjekker\ngrunnskolepoeng <- read.csv(\"D:/R/imdikator-munch/data_flat_input/grunnskolepoeng_kommune_2015_ny.csv\", row.names=NULL, na.strings=\"NA\", stringsAsFactors=FALSE, sep=\";\", dec=\",\",colClasses=\"character\")\ngrunnskolepoeng$aar[grunnskolepoeng$aar==\"2014-2015\"]=\"2015\"\ngrunnskolepoeng$enhet[grunnskolepoeng$enhet==\"person\"]=\"personer\"\nnlevels(as.factor(grunnskolepoeng$kommune_nr))\ndf_grunn = subset(grunnskolepoeng,subset=c((vreg_3==\"alle\"|vreg_3==\"NULL\")&(invalder_3==\"alle\"|invalder_3==\"NULL\")))\ngrunnskolepoeng_innvkat5 = subset(df_grunn,select=-c(vreg_3,invalder_3))\nnrow(grunnskolepoeng_innvkat5)==427*3*5*2\nwrite.csv(grunnskolepoeng_innvkat5,\"D:/R/imdikator-munch/data_flat_output/grunnskolepoeng-kommune-2015.csv\",row.names=F)\n\ndf_innv = subset(grunnskolepoeng,subset=c(vreg_3!=\"NULL\"|invalder_3!=\"NULL\"))\ngrunnskolepoeng_innvandrere = subset(df_innv,select=-innvkat_5)\nnrow(grunnskolepoeng_innvandrere)==427*3*1*3*3*2\ngrunnskolepoeng_innvandrere$tabell_navn=\"grunnskolepoeng_innvandrere\"\nwrite.csv(grunnskolepoeng_innvandrere,\"D:/R/imdikator-munch/data_flat_output/grunnskolepoeng_innvandrere-kommune-2015.csv\",row.names=F)\n\n#næringsregion - 2014\n# aar er feil - må kodes som siste året i intervallet, avgangsåret.\n# person må bli personer\n# logiske sjekker\ngrunnskolepoeng <- read.csv(\"D:/R/imdikator-munch/data_flat_input/grunnskolepoeng_næringsregion_2014_ny.csv\", row.names=NULL, na.strings=\"NA\", stringsAsFactors=FALSE, sep=\";\", dec=\",\",colClasses=\"character\")\ngrunnskolepoeng$aar[grunnskolepoeng$aar==\"2013-2014\"]=\"2014\"\ngrunnskolepoeng$enhet[grunnskolepoeng$enhet==\"person\"]=\"personer\"\nnlevels(as.factor(grunnskolepoeng$naringsregion_nr))\ndf_grunn = subset(grunnskolepoeng,subset=c((vreg_3==\"alle\"|vreg_3==\"NULL\")&(invalder_3==\"alle\"|invalder_3==\"NULL\")))\ngrunnskolepoeng_innvkat5 = subset(df_grunn,select=-c(vreg_3,invalder_3))\nnrow(grunnskolepoeng_innvkat5)==84*3*5*2\nwrite.csv(grunnskolepoeng_innvkat5,\"D:/R/imdikator-munch/data_flat_output/grunnskolepoeng-naringsregion-2014.csv\",row.names=F)\n\ndf_innv = subset(grunnskolepoeng,subset=c(vreg_3!=\"NULL\"|invalder_3!=\"NULL\"))\ngrunnskolepoeng_innvandrere = subset(df_innv,select=-innvkat_5)\nnrow(grunnskolepoeng_innvandrere)==84*3*1*3*3*2\ngrunnskolepoeng_innvandrere$tabell_navn=\"grunnskolepoeng_innvandrere\"\nwrite.csv(grunnskolepoeng_innvandrere,\"D:/R/imdikator-munch/data_flat_output/grunnskolepoeng_innvandrere-naringsregion-2014.csv\",row.names=F)\n\n#næringsregion - 2015\n# aar er feil - må kodes som siste året i intervallet, avgangsåret.\n# person må bli personer\n# logiske sjekker\ngrunnskolepoeng <- read.csv(\"D:/R/imdikator-munch/data_flat_input/grunnskolepoeng_næringsregion_2015_ny.csv\", row.names=NULL, na.strings=\"NA\", stringsAsFactors=FALSE, sep=\";\", dec=\",\",colClasses=\"character\")\ngrunnskolepoeng$aar[grunnskolepoeng$aar==\"2014-2015\"]=\"2015\"\ngrunnskolepoeng$enhet[grunnskolepoeng$enhet==\"person\"]=\"personer\"\nnlevels(as.factor(grunnskolepoeng$naringsregion_nr))\ndf_grunn = subset(grunnskolepoeng,subset=c((vreg_3==\"alle\"|vreg_3==\"NULL\")&(invalder_3==\"alle\"|invalder_3==\"NULL\")))\ngrunnskolepoeng_innvkat5 = subset(df_grunn,select=-c(vreg_3,invalder_3))\nnrow(grunnskolepoeng_innvkat5)==84*3*5*2\nwrite.csv(grunnskolepoeng_innvkat5,\"D:/R/imdikator-munch/data_flat_output/grunnskolepoeng-naringsregion-2015.csv\",row.names=F)\n\ndf_innv = subset(grunnskolepoeng,subset=c(vreg_3!=\"NULL\"|invalder_3!=\"NULL\"))\ngrunnskolepoeng_innvandrere = subset(df_innv,select=-innvkat_5)\nnrow(grunnskolepoeng_innvandrere)==84*3*1*3*3*2\ngrunnskolepoeng_innvandrere$tabell_navn=\"grunnskolepoeng_innvandrere\"\nwrite.csv(grunnskolepoeng_innvandrere,\"D:/R/imdikator-munch/data_flat_output/grunnskolepoeng_innvandrere-naringsregion-2015.csv\",row.names=F)\n\n# fylke - 2014\n# aar er feil - må kodes som siste året i intervallet, avgangsåret.\n# person må bli personer\n# logiske sjekker\ngrunnskolepoeng <- read.csv(\"D:/R/imdikator-munch/data_flat_input/grunnskolepoeng_fylke_2014_ny.csv\", row.names=NULL, na.strings=\"NA\", stringsAsFactors=FALSE, sep=\";\", dec=\",\",colClasses=\"character\")\ngrunnskolepoeng$aar[grunnskolepoeng$aar==\"2013-2014\"]=\"2014\"\ngrunnskolepoeng$enhet[grunnskolepoeng$enhet==\"person\"]=\"personer\"\nnlevels(as.factor(grunnskolepoeng$fylke_nr))\ndf_grunn = subset(grunnskolepoeng,subset=c((vreg_3==\"alle\"|vreg_3==\"NULL\")&(invalder_3==\"alle\"|invalder_3==\"NULL\")))\ngrunnskolepoeng_innvkat5 = subset(df_grunn,select=-c(vreg_3,invalder_3))\nnrow(grunnskolepoeng_innvkat5)==21*3*5*2\nwrite.csv(grunnskolepoeng_innvkat5,\"D:/R/imdikator-munch/data_flat_output/grunnskolepoeng-fylke-2014.csv\",row.names=F)\n\ndf_innv = subset(grunnskolepoeng,subset=c(vreg_3!=\"NULL\"|invalder_3!=\"NULL\"))\ngrunnskolepoeng_innvandrere = subset(df_innv,select=-innvkat_5)\nnrow(grunnskolepoeng_innvandrere)==21*3*1*3*3*2\ngrunnskolepoeng_innvandrere$tabell_navn=\"grunnskolepoeng_innvandrere\"\nwrite.csv(grunnskolepoeng_innvandrere,\"D:/R/imdikator-munch/data_flat_output/grunnskolepoeng_innvandrere-fylke-2014.csv\",row.names=F)\n\n# fylke - 2015\n# aar er feil - må kodes som siste året i intervallet, avgangsåret.\n# person må bli personer\n# logiske sjekker\ngrunnskolepoeng <- read.csv(\"D:/R/imdikator-munch/data_flat_input/grunnskolepoeng_fylke_2015_ny.csv\", row.names=NULL, na.strings=\"NA\", stringsAsFactors=FALSE, sep=\";\", dec=\",\",colClasses=\"character\")\ngrunnskolepoeng$aar[grunnskolepoeng$aar==\"2014-2015\"]=\"2015\"\ngrunnskolepoeng$enhet[grunnskolepoeng$enhet==\"person\"]=\"personer\"\nnlevels(as.factor(grunnskolepoeng$fylke_nr))\ndf_grunn = subset(grunnskolepoeng,subset=c((vreg_3==\"alle\"|vreg_3==\"NULL\")&(invalder_3==\"alle\"|invalder_3==\"NULL\")))\ngrunnskolepoeng_innvkat5 = subset(df_grunn,select=-c(vreg_3,invalder_3))\nnrow(grunnskolepoeng_innvkat5)==21*3*5*2\nwrite.csv(grunnskolepoeng_innvkat5,\"D:/R/imdikator-munch/data_flat_output/grunnskolepoeng-fylke-2015.csv\",row.names=F)\n\ndf_innv = subset(grunnskolepoeng,subset=c(vreg_3!=\"NULL\"|invalder_3!=\"NULL\"))\ngrunnskolepoeng_innvandrere = subset(df_innv,select=-innvkat_5)\nnrow(grunnskolepoeng_innvandrere)==21*3*1*3*3*2\ngrunnskolepoeng_innvandrere$tabell_navn=\"grunnskolepoeng_innvandrere\"\nwrite.csv(grunnskolepoeng_innvandrere,\"D:/R/imdikator-munch/data_flat_output/grunnskolepoeng_innvandrere-fylke-2015.csv\",row.names=F)\n\n#VIDEREGÅENDE_FULLFØRT\nlibrary(tidyr)\n#sjekk av alle komboer - 2009\nvideregaende_fullfort <- read.csv(\"D:/R/imdikator-munch/data_flat_input/diagnose/tab34_2009.csv\", row.names=NULL, na.strings=\"NA\", stringsAsFactors=FALSE, sep=\",\", dec=\".\",colClasses=\"character\")\nlevels(as.factor(videregaende_fullfort$invkat_5))\n#geoenheter * 5 innvkat * 3 kjønn * 2 enheter\ndf = subset(videregaende_fullfort,fylke_nr!=\"NULL\")\nnlevels(as.factor(df$fylke_nr))\nnrow(subset(videregaende_fullfort,fylke_nr!=\"NULL\"))==20*5*3*2\ndf_2=spread(df,invkat_5,tabellvariabel,drop=F)\n\ndf = subset(videregaende_fullfort,naringsregion_nr!=\"NULL\")\nnrow(df)==nlevels(as.factor(df$naringsregion_nr))*5*3*2\ndf_2=spread(df,invkat_5,tabellvariabel,drop=F)\n\ndf = subset(videregaende_fullfort,kommune_nr!=\"NULL\")\nnrow(df)==nlevels(as.factor(df$kommune_nr))*5*3*2\ndf_2=spread(df,invkat_5,tabellvariabel,drop=F)\n\ndf = subset(videregaende_fullfort,bydel_nr!=\"NULL\")\nnrow(df)==nlevels(as.factor(df$bydel_nr))*5*3*2\ndf_2=spread(df,invkat_5,tabellvariabel,drop=F)\n\n#VIDEREGÅENDE_FULLFØRT\nlibrary(tidyr)\n#sjekk av alle komboer - 2010\nvideregaende_fullfort <- read.csv(\"D:/R/imdikator-munch/data_flat_input/diagnose/tab34_2010.csv\", row.names=NULL, na.strings=\"NA\", stringsAsFactors=FALSE, sep=\",\", dec=\".\",colClasses=\"character\")\nlevels(as.factor(videregaende_fullfort$invkat_5))\n#geoenheter * 5 innvkat * 3 kjønn * 2 enheter\ndf = subset(videregaende_fullfort,fylke_nr!=\"NULL\")\nnrow(df)-nlevels(as.factor(df$fylke_nr))*5*3*2\n\ndf = subset(videregaende_fullfort,naringsregion_nr!=\"NULL\")\nnrow(df)-nlevels(as.factor(df$naringsregion_nr))*5*3*2\n\ndf = subset(videregaende_fullfort,kommune_nr!=\"NULL\")\nnrow(df)-nlevels(as.factor(df$kommune_nr))*5*3*2\n\n#VIDEREGÅENDE_FULLFØRT\nlibrary(tidyr)\n#sjekk av alle komboer - 2011\nvideregaende_fullfort <- read.csv(\"D:/R/imdikator-munch/data_flat_input/diagnose/tab34_2011.csv\", row.names=NULL, na.strings=\"NA\", stringsAsFactors=FALSE, sep=\",\", dec=\".\",colClasses=\"character\")\nlevels(as.factor(videregaende_fullfort$invkat_5))\n#geoenheter * 5 innvkat * 3 kjønn * 2 enheter\ndf = subset(videregaende_fullfort,fylke_nr!=\"NULL\")\nnrow(df)-nlevels(as.factor(df$fylke_nr))*5*3*2\n\ndf = subset(videregaende_fullfort,naringsregion_nr!=\"NULL\")\nnrow(df)-nlevels(as.factor(df$naringsregion_nr))*5*3*2\n\ndf = subset(videregaende_fullfort,kommune_nr!=\"NULL\")\nnrow(df)-nlevels(as.factor(df$kommune_nr))*5*3*2\n\n#SYSSELSATTE_INNVANDRINGSGRUNN\nlibrary(tidyr)\n#sjekk av alle komboer - 2011\nsysselsatte_innvandringsgrunn <- read.csv(\"D:/R/imdikator-munch/data_flat_input/diagnose/Tab_1_60a.csv\", row.names=NULL, na.strings=\"NA\", stringsAsFactors=FALSE, sep=\",\", dec=\".\",colClasses=\"character\")\nnlevels(as.factor(sysselsatte_innvandringsgrunn$kommune_nr))\nlevels(as.factor(sysselsatte_innvandringsgrunn$innvgrunn_6))\nlevels(as.factor(sysselsatte_innvandringsgrunn$aar))\nlevels(as.factor(sysselsatte_innvandringsgrunn$enhet))\n#geoenheter * 5 innvgrunn * 3 kjønn * 2 enheter * 9 år\ndf = subset(sysselsatte_innvandringsgrunn,aar==\"2014\")\nnrow(df)-nlevels(as.factor(df$kommune_nr))*5*3*2\n\n#SYSSELSATTE_INNVANDRINGSGRUNN\nlibrary(tidyr)\nsysselsatte_innvkat_alder <- read.csv(\"D:/R/imdikator-munch/data_flat_input/diagnose/Tab_9_612a.csv\", row.names=NULL, na.strings=\"NA\", stringsAsFactors=FALSE, sep=\",\", dec=\".\",colClasses=\"character\")\nnlevels(as.factor(sysselsatte_innvandringsgrunn$kommune_nr))\nlevels(as.factor(sysselsatte_innvkat_alder$arbeidsalder_18_69))\nlevels(as.factor(sysselsatte_innvandringsgrunn$aar))\nlevels(as.factor(sysselsatte_innvandringsgrunn$enhet))\n#geoenheter * 5 innvgrunn * 3 kjønn * 2 enheter * 9 år\ndf = subset(sysselsatte_innvandringsgrunn,aar==\"2014\")\nnrow(df)-nlevels(as.factor(df$kommune_nr))*5*3*2\n\n#SYSSELSATTE_BOTID\nlibrary(tidyr)\nsysselsatte_botid <- read.csv(\"D:/R/imdikator-munch/data_flat_input/diagnose/Tab_13_62a.csv\", row.names=NULL, na.strings=\"NA\", stringsAsFactors=FALSE, sep=\",\", dec=\".\",colClasses=\"character\")\nnlevels(as.factor(sysselsatte_botid$kommune_nr))\nlevels(as.factor(sysselsatte_botid$botid_5))\nlevels(as.factor(sysselsatte_botid$aar))\nlevels(as.factor(sysselsatte_botid$enhet))\n#geoenheter * 4 botid * 2 enheter * 1 år\ndf = subset(sysselsatte_botid,aar==\"2014\")\nnrow(df)-nlevels(as.factor(df$kommune_nr))*4*2\n\n#SYSSELSATTE_BOTID\nlibrary(tidyr)\nsysselsatte_botid_land <- read.csv(\"D:/R/imdikator-munch/data_flat_input/diagnose/Tab_17_631a.csv\", row.names=NULL, na.strings=\"NA\", stringsAsFactors=FALSE, sep=\",\", dec=\".\",colClasses=\"character\")\nnlevels(as.factor(sysselsatte_botid_land$kommune_nr))\nlevels(as.factor(sysselsatte_botid_land$botid_5))\nlevels(as.factor(sysselsatte_botid_land$vreg_3))\nlevels(as.factor(sysselsatte_botid_land$aar))\nlevels(as.factor(sysselsatte_botid_land$enhet))\n#geoenheter * 4 botid * 3 vreg * 2 enheter * 1 år\ndf = subset(sysselsatte_botid_land,aar==\"2014\")\nnrow(df)-nlevels(as.factor(df$kommune_nr))*4*3*2\n\n#SYSSELSATTE_KJONN_LAND\nlibrary(tidyr)\nsysselsatte_kjonn_land <- read.csv(\"D:/R/imdikator-munch/data_flat_input/diagnose/Tab_21_632a.csv\", row.names=NULL, na.strings=\"NA\", stringsAsFactors=FALSE, sep=\",\", dec=\".\",colClasses=\"character\")\nnlevels(as.factor(sysselsatte_kjonn_land$kommune_nr))\nlevels(as.factor(sysselsatte_kjonn_land$vreg_3))\nlevels(as.factor(sysselsatte_kjonn_land$kjonn))\nlevels(as.factor(sysselsatte_kjonn_land$aar))\nlevels(as.factor(sysselsatte_kjonn_land$enhet))\n#geoenheter * 3 kjønn * 3 vreg * 2 enheter * 1 år\ndf = subset(sysselsatte_kjonn_land,aar==\"2014\")\nnrow(df)-nlevels(as.factor(df$kommune_nr))*3*3*2\n\n#SYSSELSATTE_LAND\nlibrary(tidyr)\nsysselsatte_land <- read.csv(\"D:/R/imdikator-munch/data_flat_input/diagnose/Tab_25_633a.csv\", row.names=NULL, na.strings=\"NA\", stringsAsFactors=FALSE, sep=\",\", dec=\".\",colClasses=\"character\")\nnlevels(as.factor(sysselsatte_land$kommune_nr))\nlevels(as.factor(sysselsatte_land$vreg_9))\nlevels(as.factor(sysselsatte_land$aar))\nlevels(as.factor(sysselsatte_land$enhet))\n#geoenheter * 9 vreg * 2 enheter * 1 år\ndf = subset(sysselsatte_land,aar==\"2014\")\nnrow(df)-nlevels(as.factor(df$kommune_nr))*9*2\n\n#VOKSNE_VIDEREGAENDE\nlibrary(tidyr)\nvoksne_videregaende <- read.csv(\"D:/R/imdikator-munch/data_flat_input/diagnose/tab36_2012.csv\", row.names=NULL, na.strings=\"NA\", stringsAsFactors=FALSE, sep=\",\", dec=\".\",colClasses=\"character\")\nnlevels(as.factor(sysselsatte_land$kommune_nr))\nlevels(as.factor(sysselsatte_land$vreg_9))\nlevels(as.factor(sysselsatte_land$aar))\nlevels(as.factor(sysselsatte_land$enhet))\n#geoenheter * 9 vreg * 2 enheter * 1 år\ndf = subset(sysselsatte_land,aar==\"2014\")\nnrow(df)-nlevels(as.factor(df$kommune_nr))*9*2\n\n#utdanningsniva\n#2009\nutdanningsniva <- read.csv(\"D:/R/imdikator-munch/data_flat_input/diagnose/tab37_2009.csv\", row.names=NULL, na.strings=\"NA\", stringsAsFactors=FALSE, sep=\",\", dec=\".\",colClasses=\"character\")\nnames(utdanningsniva)\nlevels(as.factor(utdanningsniva$bydel_nr))\ndf=subset(utdanningsniva,utdanningsniva$bydel_nr==\"1001\")\ndf = subset(utdanningsniva,fylke_nr!=\"NULL\")\nlevels(as.factor(df$invkat_3))\nlevels(as.factor(df$kjonn))\nlevels(as.factor(df$utd_5))\nnrow(df)-nlevels(as.factor(df$fylke_nr))*3*3*6*2\n\ndf = subset(utdanningsniva,naringsregion_nr!=\"NULL\")\nnrow(df)-nlevels(as.factor(df$naringsregion_nr))*5*3*2\n\ndf = subset(videregaende_fullfort,kommune_nr!=\"NULL\")\nnrow(df)-nlevels(as.factor(df$kommune_nr))*5*3*2\n\n#2010\nutdanningsniva <- read.csv(\"D:/R/imdikator-munch/data_flat_input/diagnose/tab37_2010.csv\", row.names=NULL, na.strings=\"NA\", stringsAsFactors=FALSE, sep=\",\", dec=\".\",colClasses=\"character\")\nnames(utdanningsniva)\nlevels(as.factor(utdanningsniva$bydel_nr))\ndf = subset(utdanningsniva,fylke_nr!=\"NULL\")\nnrow(df)-nlevels(as.factor(df$fylke_nr))*3*3*6*2\n\n#2011\nutdanningsniva <- read.csv(\"D:/R/imdikator-munch/data_flat_input/diagnose/tab37_2011.csv\", row.names=NULL, na.strings=\"NA\", stringsAsFactors=FALSE, sep=\",\", dec=\".\",colClasses=\"character\")\nnames(utdanningsniva)\nlevels(as.factor(utdanningsniva$bydel_nr))\ndf = subset(utdanningsniva,fylke_nr!=\"NULL\")\nnrow(df)-nlevels(as.factor(df$fylke_nr))*3*3*6*2\n\n#2012\nutdanningsniva <- read.csv(\"D:/R/imdikator-munch/data_flat_input/diagnose/tab37_2012.csv\", row.names=NULL, na.strings=\"NA\", stringsAsFactors=FALSE, sep=\",\", dec=\".\",colClasses=\"character\")\nnames(utdanningsniva)\nlevels(as.factor(utdanningsniva$bydel_nr))\ndf = subset(utdanningsniva,fylke_nr!=\"NULL\")\nnrow(df)-nlevels(as.factor(df$fylke_nr))*3*3*6*2\n\n#2013\nutdanningsniva <- read.csv(\"D:/R/imdikator-munch/data_flat_input/diagnose/tab37_2013.csv\", row.names=NULL, na.strings=\"NA\", stringsAsFactors=FALSE, sep=\",\", dec=\".\",colClasses=\"character\")\nnames(utdanningsniva)\nlevels(as.factor(utdanningsniva$bydel_nr))\ndf = subset(utdanningsniva,fylke_nr!=\"NULL\")\nnrow(df)-nlevels(as.factor(df$fylke_nr))*3*3*6*2\n\n#2014\nutdanningsniva <- read.csv(\"D:/R/imdikator-munch/data_flat_input/diagnose/tab37_2014.csv\", row.names=NULL, na.strings=\"NA\", stringsAsFactors=FALSE, sep=\",\", dec=\".\",colClasses=\"character\")\nnames(utdanningsniva)\nlevels(as.factor(utdanningsniva$bydel_nr))\ndf = subset(utdanningsniva,fylke_nr!=\"NULL\")\nnrow(df)-nlevels(as.factor(df$fylke_nr))*3*3*6*2\n\n#geoenheter * 5 innvkat * 3 kjønn * 2 enheter\ndf = subset(videregaende_fullfort,fylke_nr!=\"NULL\")\nnrow(df)-nlevels(as.factor(df$fylke_nr))*5*3*2\n\ndf = subset(videregaende_fullfort,naringsregion_nr!=\"NULL\")\nnrow(df)-nlevels(as.factor(df$naringsregion_nr))*5*3*2\n\ndf = subset(videregaende_fullfort,kommune_nr!=\"NULL\")\nnrow(df)-nlevels(as.factor(df$kommune_nr))*5*3*2\n\n\n#VIDEREGÅENDE_DELTAKELSE\n#2011-2013\n#årstallet er feil, må kodes som siste år i perioden\nvideregaende_deltakelse <- read.csv(\"D:/R/imdikator-munch/data_flat_input/videregaende_deltakelse-alle-2011_2013.csv\", row.names=NULL, na.strings=\"NA\", stringsAsFactors=FALSE, sep=\",\", dec=\".\",colClasses=\"character\")\nvideregaende_deltakelse$aar = \"2013\"\nwrite.csv(videregaende_deltakelse,\"D:/R/imdikator-munch/data_flat_output/videregaende_deltakelse-alle-2011_2013.csv\",row.names=F)\n#2012-2014\nvideregaende_deltakelse <- read.csv(\"D:/R/imdikator-munch/data_flat_input/videregaende_deltakelse-alle-2012_2014.csv\", row.names=NULL, na.strings=\"NA\", stringsAsFactors=FALSE, sep=\",\", dec=\".\",colClasses=\"character\")\nvideregaende_deltakelse$aar = \"2014\"\nwrite.csv(videregaende_deltakelse,\"D:/R/imdikator-munch/data_flat_output/videregaende_deltakelse-alle-2012_2014.csv\",row.names=F)\n\n#BOSATT_ANMODEDE\n#21. januar 2016\n#1. kommunedata 2014\n#2. andre nivåer 2014\n#3. kommunedata 2015-2017\n#4. fylkesdata 2015-2017\n#5. andre nivåer 2015-2017\n\n#kommune 2014\nlibrary(tidyr)\nbosatt_anmodede <- read.csv(\"D:/R/imdikator-munch/data_crossed_input/bosatt_anmodede-kommune-2014.csv\", row.names=NULL, na.strings=\"NA\", stringsAsFactors=FALSE, sep=\";\", dec=\".\",colClasses=\"character\")\nbosatt_anmodede = subset(bosatt_anmodede,select=c(1,3,4,5))\nnames(bosatt_anmodede)=c(\"kommune_nr\",\"anmodning_personer\",\"vedtak_personer\",\"bosatt_personer\")\nbosatt_anmodede$anmodning_prosent = (as.numeric(bosatt_anmodede$anmodning_personer)/as.numeric(bosatt_anmodede$anmodning_personer))*100\nbosatt_anmodede$vedtak_prosent = (as.numeric(bosatt_anmodede$vedtak_personer)/as.numeric(bosatt_anmodede$anmodning_personer))*100\nbosatt_anmodede$bosatt_prosent = (as.numeric(bosatt_anmodede$bosatt_personer)/as.numeric(bosatt_anmodede$anmodning_personer))*100\ndf = gather(bosatt_anmodede,\"variabler\",\"tabellvariabel\",2:7)\ndf = separate(df,variabler,c(\"bosetting\",\"enhet\"),sep=\"_\")\ndf$tabellvariabel[is.na(df$tabellvariabel)==T]=\".\"\n#logisk sjekk\nnrow(df)==429*3*2\n#resterende\ndf$tabell_navn=\"bosatt_anmodede\"\ndf$aar=\"2014\"\nwrite.csv(df,\"D:/R/imdikator-munch/data_flat_output/bosetting_anmodede-kommune-2014.csv\",row.names=F)\n\n#næringsregion 2014\nkinfo <- read.csv(\"D:/R/imdikator-munch/parameters/kommunesort.csv\", sep=\";\", stringsAsFactors=FALSE)\nkinfo = subset(kinfo,select=c(\"Nr\",\"Naringregnr\"))\nnames(kinfo)[2] = \"naringsregion_nr\"\nkinfo$Nr[nchar(kinfo$Nr)==3] = paste0(\"0\",kinfo$Nr[nchar(kinfo$Nr)==3])\nkinfo$naringsregion_nr[nchar(kinfo$naringsregion_nr)==1] = paste0(\"0\",kinfo$naringsregion_nr[nchar(kinfo$naringsregion_nr)==1])\nbosatt_anmodede <- read.csv(\"D:/R/imdikator-munch/data_crossed_input/bosatt_anmodede-kommune-2014-tilaggregering.csv\", row.names=NULL, na.strings=c(\"NA\"), stringsAsFactors=FALSE, sep=\";\", dec=\".\")\nsum(is.na(bosatt_anmodede))\nsum(bosatt_anmodede==\":\")\nsum(bosatt_anmodede==\".\")\n#skal ikke leses inn som character, men med NA.strings =\".\"&\":\"\n#logikken er at det ikke er : på dette nivået, fordi tallene skal aggregeres - det er bare missing\n#og hvis det er \":\", så skal disse uansett bli . på aggregert n ivå\nbosatt_anmodede <- read.csv(\"D:/R/imdikator-munch/data_crossed_input/bosatt_anmodede-kommune-2014-tilaggregering.csv\", row.names=NULL, na.strings=c(\"NA\",\".\"), stringsAsFactors=FALSE, sep=\";\", dec=\".\")\nchecksum_start = sum(bosatt_anmodede$bosatt_2014,na.rm=T)\nbosatt_anmodede$kommune_nr[nchar(bosatt_anmodede$kommune_nr)==3] = paste0(\"0\",bosatt_anmodede$kommune_nr[nchar(bosatt_anmodede$kommune_nr)==3])\n#vedtak kan være \".\", hvis henvendelse ikke er besvart-.\n#bosetting og anmodning kan ikke være \".\", skal være 0\nsum(is.na(bosatt_anmodede$bosatt_2014)==T)\nbosatt_anmodede$bosatt_2014[is.na(bosatt_anmodede$bosatt_2014)==T]=0\nsum(is.na(bosatt_anmodede$anmodning_2014)==T)\nbosatt_anmodede$anmodning_2014[is.na(bosatt_anmodede$anmodning_2014)==T]=0\nsum(is.na(bosatt_anmodede$vedtak_2014)==T)\nbosatt_anmodede$vedtak_2014[is.na(bosatt_anmodede$vedtak_2014)==T]=0\ndf = merge(bosatt_anmodede,kinfo,by.x=\"kommune_nr\",by.y =\"Nr\",all.x=T,all.y=T)\nlibrary(reshape)\nbosatt_anmodede_m = melt.data.frame(df,id.vars=c(\"kommune_nr\",\"naringsregion_nr\"),na.rm=F)\nbosatt_anmodede_nareg = cast(bosatt_anmodede_m,naringsregion_nr~variable,fun.aggregate=sum,na.rm=F,add.missing=T,fill=NA)\nchecksum_start == sum(bosatt_anmodede_nareg$bosatt_2014)\nnames(bosatt_anmodede_nareg)=c(\"naringsregion_nr\",\"bosatt_personer\",\"anmodning_personer\",\"vedtak_personer\")\nbosatt_anmodede_nareg$anmodning_prosent = (as.numeric(bosatt_anmodede_nareg$anmodning_personer)/as.numeric(bosatt_anmodede_nareg$anmodning_personer))*100\nbosatt_anmodede_nareg$vedtak_prosent = (as.numeric(bosatt_anmodede_nareg$vedtak_personer)/as.numeric(bosatt_anmodede_nareg$anmodning_personer))*100\nbosatt_anmodede_nareg$bosatt_prosent = (as.numeric(bosatt_anmodede_nareg$bosatt_personer)/as.numeric(bosatt_anmodede_nareg$anmodning_personer))*100\ndf = gather(bosatt_anmodede_nareg,\"variabler\",\"tabellvariabel\",2:7)\ndf = separate(df,variabler,c(\"bosetting\",\"enhet\"),sep=\"_\")\ndf$tabellvariabel[is.na(df$tabellvariabel)==T]=\".\"\n#logisk sjekk\nnrow(df)==84*3*2\n#resterende\ndf$tabell_navn=\"bosatt_anmodede\"\ndf$aar=\"2014\"\nwrite.csv(df,\"D:/R/imdikator-munch/data_flat_output/bosetting_anmodede-naringsregion-2014.csv\",row.names=F)\n\n#fylke 2014\nkinfo = read.csv(\"D:/R/imdikator-munch/parameters/kommunesort.csv\", sep=\";\", stringsAsFactors=FALSE)\nkinfo = subset(kinfo,select=c(\"Nr\",\"Fylkenr\"))\nnames(kinfo)[2] = \"fylke_nr\"\nkinfo$fylke_nr[nchar(kinfo$fylke_nr)==1] = paste0(\"0\",kinfo$fylke_nr[nchar(kinfo$fylke_nr)==1])\n#bosettingsdata spesielt og data for aggregering generelt skal ikke leses inn som character, men med NA.strings =\".\"&\":\"\n#logikken er at det ikke er : på dette nivået, fordi tallene skal aggregeres - det er bare missing\n#og hvis det er \":\", så skal disse uansett bli . på aggregert n ivå\nbosatt_anmodede <- read.csv(\"D:/R/imdikator-munch/data_crossed_input/bosatt_anmodede-kommune-2014-tilaggregering.csv\", row.names=NULL, na.strings=c(\"NA\",\".\"), stringsAsFactors=FALSE, sep=\";\", dec=\".\")\nchecksum_start = sum(bosatt_anmodede$bosatt_2014,na.rm=T)\n#vedtak kan være \".\", hvis henvendelse ikke er besvart-.\n#bosetting og anmodning kan ikke være \".\", skal være 0\nsum(is.na(bosatt_anmodede$bosatt_2014)==T)\nbosatt_anmodede$bosatt_2014[is.na(bosatt_anmodede$bosatt_2014)==T]=0\nsum(is.na(bosatt_anmodede$anmodning_2014)==T)\nbosatt_anmodede$anmodning_2014[is.na(bosatt_anmodede$anmodning_2014)==T]=0\nsum(is.na(bosatt_anmodede$vedtak_2014)==T)\nbosatt_anmodede$vedtak_2014[is.na(bosatt_anmodede$vedtak_2014)==T]=0\ndf = merge(bosatt_anmodede,kinfo,by.x=\"kommune_nr\",by.y =\"Nr\",all.x=T,all.y=T)\nlibrary(reshape)\nbosatt_anmodede_m = melt.data.frame(df,id.vars=c(\"kommune_nr\",\"fylke_nr\"),na.rm=F)\nbosatt_anmodede_fylke = cast(bosatt_anmodede_m,fylke_nr~variable,fun.aggregate=sum,na.rm=F,add.missing=T,fill=NA, margins=\"grand_row\")\nbosatt_anmodede_fylke = subset(bosatt_anmodede_fylke,select=-5)\nchecksum_start == sum(bosatt_anmodede_fylke$bosatt_2014)/2\nnames(bosatt_anmodede_fylke)=c(\"fylke_nr\",\"bosatt_personer\",\"anmodning_personer\",\"vedtak_personer\")\nbosatt_anmodede_fylke$anmodning_prosent = (as.numeric(bosatt_anmodede_fylke$anmodning_personer)/as.numeric(bosatt_anmodede_fylke$anmodning_personer))*100\nbosatt_anmodede_fylke$vedtak_prosent = (as.numeric(bosatt_anmodede_fylke$vedtak_personer)/as.numeric(bosatt_anmodede_fylke$anmodning_personer))*100\nbosatt_anmodede_fylke$bosatt_prosent = (as.numeric(bosatt_anmodede_fylke$bosatt_personer)/as.numeric(bosatt_anmodede_fylke$anmodning_personer))*100\ndf = gather(bosatt_anmodede_fylke,\"variabler\",\"tabellvariabel\",2:7)\ndf = separate(df,variabler,c(\"bosetting\",\"enhet\"),sep=\"_\")\nsum(is.na(df$tabellvariabel)==T)\ndf$tabellvariabel[is.na(df$tabellvariabel)==T]=\".\"\n#logisk sjekk\nnrow(df)==21*3*2\n#resterende\ndf$tabell_navn=\"bosatt_anmodede\"\ndf$aar=\"2014\"\n#.==regexp any single character\ndf$fylke_nr = gsub(\".all.\",\"00\",df$fylke_nr)\nwrite.csv(df,\"D:/R/imdikator-munch/data_flat_output/bosetting_anmodede-fylke-2014.csv\",row.names=F)\n\n#3. kommunedata 2015-2017\nbosatt_anmodede = read.csv(\"D:/R/imdikator-munch/data_crossed_input/bosatt_anmodede-kommune-2015_2017.csv\", row.names=NULL, na.strings=c(\"NA\",\":\",\".\"), stringsAsFactors=FALSE, sep=\";\", dec=\",\")\nchecksum = sum(bosatt_anmodede$vedtak_2016_personer,na.rm=T)\ndf = gather(bosatt_anmodede,variables,tabellvariabel,2:19)\ndf = separate(df,variables,into=c(\"bosetting\",\"aar\",\"enhet\"),sep=\"_\")\nnlevels(as.factor(df$kommune_nr))\n#i anmodnings- og vedtakstall på kommunenivå 2015-2017 er bosetting manglende, anmodning ikke : eller . men 0, og vedtak enten 0 eller NA.\ndf$tabellvariabel[df$bosetting==\"bosatt\"&is.na(df$tabellvariabel)==T]=\".\"\ndf$tabellvariabel[df$bosetting==\"anmodning\"&is.na(df$tabellvariabel)==T]=0\ndf$tabellvariabel[df$bosetting==\"vedtak\"&is.na(df$tabellvariabel)==T]=\".\"\nchecksum == sum(as.numeric(df$tabellvariabel[df$bosetting==\"vedtak\"&df$aar==\"2016\"&df$enhet==\"personer\"]),na.rm=T)\n#logisk sjekk\nnrow(df)==428*3*3*2\n#resterende\ndf$tabell_navn=\"bosatt_anmodede\"\ndf$kommune_nr[nchar(df$kommune_nr)==3] = paste0(\"0\",df$kommune_nr[nchar(df$kommune_nr)==3])\nwrite.csv(df,\"D:/R/imdikator-munch/data_flat_output/bosetting_anmodede-kommune-2015_2017.csv\",row.names=F)\n\n#4. fylkesdata 2015-2017\nbosatt_anmodede = read.csv(\"D:/R/imdikator-munch/data_crossed_input/bosatt_anmodede-fylke-2015_2017.csv\", row.names=NULL, na.strings=c(\"NA\",\":\",\".\"), stringsAsFactors=FALSE, sep=\";\", dec=\",\")\nchecksum = sum(bosatt_anmodede$vedtak_2016_personer,na.rm=T)/2\ndf = gather(bosatt_anmodede,variables,tabellvariabel,2:19)\ndf = separate(df,variables,into=c(\"bosetting\",\"aar\",\"enhet\"),sep=\"_\")\nnlevels(as.factor(df$fylke_nr))\n#i anmodnings- og vedtakstall på fylkenivå 2015-2017 er bosetting manglende, anmodning ikke : eller . men 0, og vedtak enten 0 eller NA.\ndf$tabellvariabel[df$bosetting==\"bosatt\"&is.na(df$tabellvariabel)==T]=\".\"\ndf$tabellvariabel[df$bosetting==\"anmodning\"&is.na(df$tabellvariabel)==T]=0\ndf$tabellvariabel[df$bosetting==\"vedtak\"&is.na(df$tabellvariabel)==T]=\".\"\nchecksum == sum(as.numeric(df$tabellvariabel[df$bosetting==\"vedtak\"&df$aar==\"2016\"&df$enhet==\"personer\"]),na.rm=T)\n#logisk sjekk\nnrow(df)==20*3*3*2\n#resterende\ndf$tabell_navn=\"bosatt_anmodede\"\ndf$fylke_nr[nchar(df$fylke_nr)==1] = paste0(\"0\",df$fylke_nr[nchar(df$fylke_nr)==1])\nwrite.csv(df,\"D:/R/imdikator-munch/data_flat_output/bosetting_anmodede-fylke-2015_2017.csv\",row.names=F)\n\n#5. næringsregion 2015-2017\nbosatt_anmodede = read.csv(\"D:/R/imdikator-munch/data_crossed_input/bosatt_anmodede-kommune-2015_2017.csv\", row.names=NULL, na.strings=c(\"NA\",\":\",\".\"), stringsAsFactors=FALSE, sep=\";\", dec=\",\")\nchecksum = sum(bosatt_anmodede$anmodning_2016_personer,na.rm=T)\nbosatt_anmodede = subset(bosatt_anmodede,select=1:10)\nkinfo <- read.csv(\"D:/R/imdikator-munch/parameters/kommunesort.csv\", sep=\";\", stringsAsFactors=FALSE)\nkinfo = subset(kinfo,select=c(\"Nr\",\"Naringregnr\"))\nnames(kinfo)[2] = \"naringsregion_nr\"\nkinfo$naringsregion_nr[nchar(kinfo$naringsregion_nr)==1] = paste0(\"0\",kinfo$naringsregion_nr[nchar(kinfo$naringsregion_nr)==1])\ndf = merge(bosatt_anmodede,kinfo,by.x=\"kommune_nr\",by.y =\"Nr\",all.x=T,all.y=T)\n#vedtak kan være \".\", hvis henvendelse ikke er besvart. ved aggregering av vedtak\n# settes disse lik 0. det samme gjelder NA bosetting, og NA anmodning\n#bosetting og anmodning kan ikke være \".\", skal være 0\ndf[is.na(df)==T]=0\nbosatt_anmodede_m = melt.data.frame(df,id.vars=c(\"kommune_nr\",\"naringsregion_nr\"),na.rm=F)\nbosatt_anmodede_nareg = cast(bosatt_anmodede_m,naringsregion_nr~variable,fun.aggregate=sum,na.rm=F,add.missing=T,fill=NA)\n\nbosatt_anmodede_nareg$anmodning_2015_prosent = (as.numeric(bosatt_anmodede_nareg$anmodning_2015_personer)/as.numeric(bosatt_anmodede_nareg$anmodning_2015_personer))*100\nbosatt_anmodede_nareg$vedtak_2015_prosent = (as.numeric(bosatt_anmodede_nareg$vedtak_2015_personer)/as.numeric(bosatt_anmodede_nareg$anmodning_2015_personer))*100\nbosatt_anmodede_nareg$bosatt_2015_prosent = (as.numeric(bosatt_anmodede_nareg$bosatt_2015_personer)/as.numeric(bosatt_anmodede_nareg$anmodning_2015_personer))*100\nbosatt_anmodede_nareg$anmodning_2016_prosent = (as.numeric(bosatt_anmodede_nareg$anmodning_2016_personer)/as.numeric(bosatt_anmodede_nareg$anmodning_2016_personer))*100\nbosatt_anmodede_nareg$vedtak_2016_prosent = (as.numeric(bosatt_anmodede_nareg$vedtak_2016_personer)/as.numeric(bosatt_anmodede_nareg$anmodning_2016_personer))*100\nbosatt_anmodede_nareg$bosatt_2016_prosent = (as.numeric(bosatt_anmodede_nareg$bosatt_2016_personer)/as.numeric(bosatt_anmodede_nareg$anmodning_2016_personer))*100\nbosatt_anmodede_nareg$anmodning_2017_prosent = (as.numeric(bosatt_anmodede_nareg$anmodning_2017_personer)/as.numeric(bosatt_anmodede_nareg$anmodning_2017_personer))*100\nbosatt_anmodede_nareg$vedtak_2017_prosent = (as.numeric(bosatt_anmodede_nareg$vedtak_2017_personer)/as.numeric(bosatt_anmodede_nareg$anmodning_2017_personer))*100\nbosatt_anmodede_nareg$bosatt_2017_prosent = (as.numeric(bosatt_anmodede_nareg$bosatt_2017_personer)/as.numeric(bosatt_anmodede_nareg$anmodning_2017_personer))*100\n\ndf = gather(bosatt_anmodede_nareg,variables,tabellvariabel,2:19)\ndf = separate(df,variables,into=c(\"bosetting\",\"aar\",\"enhet\"),sep=\"_\")\nnlevels(as.factor(df$naringsregion_nr))\n\n#i anmodnings- og vedtakstall på naringsregion 2015-2017 er\n# bosetting manglende (.), anmodning 0, og vedtak enten 0 eller \".\".\ndf$tabellvariabel[df$bosetting==\"bosatt\"&df$tabellvariabel==0]=\".\"\ndf$tabellvariabel[df$bosetting==\"vedtak\"&df$tabellvariabel==\"0\"]=\".\"\n#logisk sjekk\nnrow(df)==84*3*3*2\n#resterende\ndf$tabell_navn=\"bosatt_anmodede\"\nwrite.csv(df,\"D:/R/imdikator-munch/data_flat_output/bosetting_anmodede-naringsregion-2015_2017.csv\",row.names=F)\n",
    "created" : 1445855157704.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1267953585",
    "id" : "C2C481EF",
    "lastKnownWriteTime" : 1453406242,
    "path" : "D:/R/imdikator-munch/diagnose.R",
    "project_path" : "diagnose.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "type" : "r_source"
}